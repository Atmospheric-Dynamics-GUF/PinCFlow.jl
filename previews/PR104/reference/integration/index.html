<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Integration · PinCFlow.jl</title><meta name="title" content="Integration · PinCFlow.jl"/><meta property="og:title" content="Integration · PinCFlow.jl"/><meta property="twitter:title" content="Integration · PinCFlow.jl"/><meta name="description" content="Documentation for PinCFlow.jl."/><meta property="og:description" content="Documentation for PinCFlow.jl."/><meta property="twitter:description" content="Documentation for PinCFlow.jl."/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">PinCFlow.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../../examples/mountain_wave_simulation/">Mountain-wave simulation</a></li><li><a class="tocitem" href="../../examples/wkb_mountain_wave_simulation/">WKB mountain-wave simulation</a></li></ul></li><li><span class="tocitem">Theory</span><ul><li><a class="tocitem" href="../../theory/physics/">Physics</a></li><li><a class="tocitem" href="../../theory/numerics/">Numerics</a></li></ul></li><li><span class="tocitem">Reference</span><ul><li><a class="tocitem" href="../pincflow/">PinCFlow</a></li><li><a class="tocitem" href="../types/">Types</a></li><li><a class="tocitem" href="../mpi_operations/">MPIOperations</a></li><li><a class="tocitem" href="../boundaries/">Boundaries</a></li><li><a class="tocitem" href="../flux_calculator/">FluxCalculator</a></li><li><a class="tocitem" href="../poisson_solver/">PoissonSolver</a></li><li><a class="tocitem" href="../update/">Update</a></li><li><a class="tocitem" href="../msgwam/">MSGWaM</a></li><li class="is-active"><a class="tocitem" href>Integration</a></li><li><a class="tocitem" href="../output/">Output</a></li></ul></li><li><a class="tocitem" href="../../developer_guide/">Developer guide</a></li><li><a class="tocitem" href="../../changelog/">Changelog</a></li><li><a class="tocitem" href="../../authors/">Authors</a></li><li><a class="tocitem" href="../../contributing/">Contributing</a></li><li><a class="tocitem" href="../../code_of_conduct/">Code of Conduct</a></li><li><a class="tocitem" href="../../license/">License</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Reference</a></li><li class="is-active"><a href>Integration</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Integration</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/Atmospheric-Dynamics-GUF/PinCFlow.jl.git" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Integration"><a class="docs-heading-anchor" href="#Integration">Integration</a><a id="Integration-1"></a><a class="docs-heading-anchor-permalink" href="#Integration" title="Permalink"></a></h1><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="PinCFlow.Integration" href="#PinCFlow.Integration"><code>PinCFlow.Integration</code></a> — <span class="docstring-category">Module</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">Integration</code></pre><p>Module for integration of the full system.</p><p>Provides helper functions for computing the time step, managing time levels and synchronizing fields, as well as the main function for running PinCFlow.jl.</p><p><strong>See also</strong></p><ul><li><p><a href="../types/#PinCFlow.Types"><code>PinCFlow.Types</code></a></p></li><li><p><a href="../boundaries/#PinCFlow.Boundaries"><code>PinCFlow.Boundaries</code></a></p></li><li><p><a href="../update/#PinCFlow.Update"><code>PinCFlow.Update</code></a></p></li><li><p><a href="../poisson_solver/#PinCFlow.PoissonSolver"><code>PinCFlow.PoissonSolver</code></a></p></li><li><p><a href="../flux_calculator/#PinCFlow.FluxCalculator"><code>PinCFlow.FluxCalculator</code></a></p></li><li><p><a href="../output/#PinCFlow.Output"><code>PinCFlow.Output</code></a></p></li><li><p><a href="../msgwam/#PinCFlow.MSGWaM"><code>PinCFlow.MSGWaM</code></a></p></li></ul></div></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="PinCFlow.Integration.backup_predictands" href="#PinCFlow.Integration.backup_predictands"><code>PinCFlow.Integration.backup_predictands</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">backup_predictands(state::State)::Tuple{&lt;:Predictands, &lt;:TracerPredictands}</code></pre><p>Return a tuple with a copy of the predictands and tracer predictands.</p><p><strong>Arguments</strong></p><ul><li><code>state</code>: Model state</li></ul></div></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="PinCFlow.Integration.compute_time_step" href="#PinCFlow.Integration.compute_time_step"><code>PinCFlow.Integration.compute_time_step</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">compute_time_step(state::State)::AbstractFloat</code></pre><p>Compute and return an adaptive time step based on several stability criteria.</p><p>If <code>state.namelists.discretization.adaptive_time_step</code> is set to <code>true</code>, the returned time step is given by</p><p class="math-container">\[\Delta t = \min \left(\Delta t_\mathrm{CFL}, \Delta t_\mathrm{WKB}, \Delta t_\mathrm{viscous}, \Delta t_{\max}\right),\]</p><p>where <span>$\Delta t_\mathrm{CFL}$</span> and <span>$\Delta t_\mathrm{WKB}$</span> are computed from CFL conditions with respect to the resolved flow and unresolved gravity waves, respectively, <span>$\Delta t_\mathrm{viscous}$</span> is determined from a von Neumann condition that takes the viscosity into account and <span>$\Delta t_{\max}$</span> is an upper limit specified in <code>state.namelists.discretization</code>. Otherwise, the returned time step is equal to <span>$\Delta t_{\max}$</span>. If <span>$\Delta t$</span> is smaller than <span>$\Delta t_{\min}$</span> (also specified in <code>state.namelists.discretization</code>), an error is thrown.</p><p>The individual stability criteria are as follows.</p><ul><li><p>CFL condition with respect to the resolved flow (where <span>$w$</span> is computed with <code>compute_vertical_wind</code>):</p><p class="math-container">\[\Delta t_\mathrm{CFL} = \mu_\mathrm{CFL} \min\limits_\mathrm{global} \left[\frac{\Delta \widehat{x}}{u_{\max}}, \frac{\Delta \widehat{y}}{v_{\max}}, \min \left(\frac{J \Delta \widehat{z}}{w}\right)\right]\]</p></li><li><p>CFL condition with respect to the group velocities of unresolved gravity waves (where <span>$J_{\min}$</span> is the minimum Jacobian in a one-grid-cell radius and <span>$c_{\mathrm{g} z}$</span> is the maximum vertical group velocity within a grid cell):</p><p class="math-container">\[\Delta t_\mathrm{WKB} = \mu_\mathrm{WKB} \min\limits_\mathrm{global} \left[\frac{\Delta \widehat{x}}{c_{\mathrm{g} x, \max}}, \frac{\Delta \widehat{y}}{c_{\mathrm{g} y, \max}}, \min \left(\frac{J_{\min} \Delta \widehat{z}}{c_{\mathrm{g} z}}\right)\right]\]</p></li><li><p>Von Neumann condition (with <span>$\mathrm{Re}$</span> being the Reynolds number):</p><p class="math-container">\[\Delta t_\mathrm{viscous} = \frac{\mathrm{Re}}{2} \min\limits_\mathrm{global} \left[\left(\Delta \widehat{x}\right)^2, \left(\Delta \widehat{y}\right)^2, \left(J \Delta \widehat{z}\right)^2\right]\]</p></li></ul><p><strong>Arguments</strong></p><ul><li><code>state</code>: Model state.</li></ul><p><strong>See also</strong></p><ul><li><a href="../update/#PinCFlow.Update.compute_vertical_wind"><code>PinCFlow.Update.compute_vertical_wind</code></a></li></ul></div></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="PinCFlow.Integration.explicit_integration!" href="#PinCFlow.Integration.explicit_integration!"><code>PinCFlow.Integration.explicit_integration!</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">explicit_integration!(
    state::State,
    p0::Predictands,
    dtstage::AbstractFloat,
    time::AbstractFloat,
    side::LHS,
)</code></pre><p>Integrate the left-hand sides of the prognostic equations with a Runge-Kutta time step.</p><p>At each Runge-Kutta stage, the prognostic variables are first reconstructed and their advective and diffusive fluxes are calculated. Subsequently, each variable is updated with its integrated left-hand side, followed immediately by an implicit Euler step (the size of which is the fractional time step at the current Runge-Kutta stage) that accounts for the Rayleigh-damping imposed by the LHS sponge. After the Runge-Kutta loop, if the atmosphere is compressible, the Exner-pressure is updated with a full implicit Euler step to account for it being impacted by the Rayleigh damping of the mass-weighted potential temperature.</p><pre><code class="language-julia hljs">explicit_integration!(
    state::State,
    p0::Predictands,
    dtstage::AbstractFloat,
    time::AbstractFloat,
    side::RHS,
)</code></pre><p>Perform an explicit Euler step on the right-hand sides of the prognostic equations and, if the atmosphere is compressible, update the Exner-pressure such that it is synchronized with the mass-weighted potential temperature.</p><p><strong>Arguments</strong></p><ul><li><p><code>state</code>: Model state.</p></li><li><p><code>p0</code>: The predictands that are used to compute the transporting velocities in the computation of the fluxes.</p></li><li><p><code>dtstage</code>: Fractional time step.</p></li><li><p><code>time</code>: Simulation time.</p></li><li><p><code>side</code>: Side of the equations.</p></li></ul></div></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="PinCFlow.Integration.implicit_integration!" href="#PinCFlow.Integration.implicit_integration!"><code>PinCFlow.Integration.implicit_integration!</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">implicit_integration!(
    state::State,
    dtstage::AbstractFloat,
    time::AbstractFloat,
    ntotalbicg::Integer,
    side::RHS,
    rayleigh_factor::AbstractFloat,
    iout::Integer,
    machine_start_time::DateTime,
)</code></pre><p>Perform an implicit Euler step on the right-hand sides of the prognostic equations, solve the Poisson equation and correct the Exner-pressure, momentum and density fluctuations accordingly.</p><p><strong>Arguments</strong></p><ul><li><p><code>state</code>: Model state.</p></li><li><p><code>dtstage</code>: Fractional time step.</p></li><li><p><code>time</code>: Simulation time.</p></li><li><p><code>ntotalbicg</code>: BicGStab-iterations counter.</p></li><li><p><code>side</code>: Side of the equations.</p></li><li><p><code>rayleigh_factor</code>: Factor by which the Rayleigh-damping coefficient is multiplied.</p></li><li><p><code>iout</code>: Output counter.</p></li><li><p><code>machine_start_time</code>: Wall-clock start time.</p></li></ul></div></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="PinCFlow.Integration.integrate" href="#PinCFlow.Integration.integrate"><code>PinCFlow.Integration.integrate</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">integrate(namelists::Namelists)</code></pre><p>Initialize the model state and integrate it in time.</p><p>This method performs the complete time integration of the governing equations, using a semi-implicit time stepping scheme. It handles initialization, time stepping and output of the simulation data.</p><p>The initialization begins with the construction of the model state (an instance of the composite type <code>State</code>), which involves the setup of the MPI parallelization and the definition of all arrays that are needed repeatedly during the simulation. This is followed by an (optional) initial cleaning, in which the Poisson solver is called to ensure that the initial dynamic fields satisfy the divergence constraint imposed by the thermodynamic energy equation. Afterwards, the initialization of MSGWaM is completed by adding ray volumes to the previously defined arrays. If the simulation is supposed to start from a previous model state, the fields are then overwritten with the data in the corresponding input file. Finally, the output file is created and the initial state is written into it.</p><p>At the beginning of each time-loop iteration, the time step is determined from several stability criteria, using <code>compute_time_step</code>. In case the updated simulation time is later than the next output time, the time step is corrected accordingly. Subsequently, the damping coefficients of the sponges (which may depend on the time step) are calculated. Following this, MSGWaM updates the unresolved gravity-wave field and computes the corresponding mean-flow impact. Afterwards, the resolved flow is updated in a semi-implicit time step, comprised of the following stages.</p><ol><li><p>Explicit RK3 integration of LHS over <span>$\Delta t / 2$</span>.</p></li><li><p>Implicit Euler integration of RHS over <span>$\Delta t / 2$</span>.</p></li><li><p>Explicit Euler integration of RHS over <span>$\Delta t / 2$</span>.</p></li><li><p>Explicit RK3 integration of LHS over <span>$\Delta t$</span>.</p></li><li><p>Implicit Euler integration of RHS over <span>$\Delta t / 2$</span>.</p></li></ol><p>Therein, the left-hand sides of the equations include advective fluxes, diffusion terms, rotation and heating, whereas the pressure gradient, buoyancy term and momentum-flux divergence due to unresolved gravity waves are on the right-hand sides. Boundary conditions are enforced continuously. At the end of the time step, the updated fields are written into the output file if the next output time has been reached.</p><p><strong>Arguments</strong></p><ul><li><code>namelists</code>: Namelists with all model parameters.</li></ul><p><strong>See also</strong></p><ul><li><p><a href="../types/#PinCFlow.Types.State"><code>PinCFlow.Types.State</code></a></p></li><li><p><a href="#PinCFlow.Integration.modify_compressible_wind!"><code>PinCFlow.Integration.modify_compressible_wind!</code></a></p></li><li><p><a href="../boundaries/#PinCFlow.Boundaries.set_boundaries!"><code>PinCFlow.Boundaries.set_boundaries!</code></a></p></li><li><p><a href="../poisson_solver/#PinCFlow.PoissonSolver.apply_corrector!"><code>PinCFlow.PoissonSolver.apply_corrector!</code></a></p></li><li><p><a href="../output/#PinCFlow.Output.create_output"><code>PinCFlow.Output.create_output</code></a></p></li><li><p><a href="../output/#PinCFlow.Output.write_output"><code>PinCFlow.Output.write_output</code></a></p></li><li><p><a href="../msgwam/#PinCFlow.MSGWaM.RayUpdate.initialize_rays!"><code>PinCFlow.MSGWaM.RayUpdate.initialize_rays!</code></a></p></li><li><p><a href="../output/#PinCFlow.Output.read_input!"><code>PinCFlow.Output.read_input!</code></a></p></li><li><p><a href="#PinCFlow.Integration.synchronize_compressible_atmosphere!"><code>PinCFlow.Integration.synchronize_compressible_atmosphere!</code></a></p></li><li><p><a href="#PinCFlow.Integration.compute_time_step"><code>PinCFlow.Integration.compute_time_step</code></a></p></li><li><p><a href="../update/#PinCFlow.Update.compute_sponges!"><code>PinCFlow.Update.compute_sponges!</code></a></p></li><li><p><a href="#PinCFlow.Integration.wkb_integration!"><code>PinCFlow.Integration.wkb_integration!</code></a></p></li><li><p><a href="#PinCFlow.Integration.synchronize_density_fluctuations!"><code>PinCFlow.Integration.synchronize_density_fluctuations!</code></a></p></li><li><p><a href="#PinCFlow.Integration.explicit_integration!"><code>PinCFlow.Integration.explicit_integration!</code></a></p></li><li><p><a href="#PinCFlow.Integration.implicit_integration!"><code>PinCFlow.Integration.implicit_integration!</code></a></p></li><li><p><a href="#PinCFlow.Integration.reset_predictands!"><code>PinCFlow.Integration.reset_predictands!</code></a></p></li></ul></div></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="PinCFlow.Integration.modify_compressible_wind!" href="#PinCFlow.Integration.modify_compressible_wind!"><code>PinCFlow.Integration.modify_compressible_wind!</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">modify_compressible_wind!(state::State, operation::Function)</code></pre><p>Modify the wind with <span>$J P$</span> if the atmosphere is compressible by dispatching to the appropriate method.</p><pre><code class="language-julia hljs">modify_compressible_wind!(
    state::State,
    operation::Function,
    model::Union{Boussinesq, PseudoIncompressible},
)</code></pre><p>Return in non-compressible modes.</p><pre><code class="language-julia hljs">modify_compressible_wind!(
    state::State,
    operation::Function,
    model::Compressible,
)</code></pre><p>Interpolate <span>$J P$</span> to the wind grids and replace the wind components with the result of applying <code>operation</code> to them and the interpolations.</p><p><strong>Arguments</strong></p><ul><li><p><code>state</code>: Model state.</p></li><li><p><code>operation</code>: Binary operation used for modification.</p></li><li><p><code>model</code>: Dynamic equations.</p></li></ul></div></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="PinCFlow.Integration.reset_predictands!" href="#PinCFlow.Integration.reset_predictands!"><code>PinCFlow.Integration.reset_predictands!</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">reset_predictands!(
    state::State,
    predictands::Predictands,
    tracerpredictands::TracerPredictands,
)</code></pre><p>Reset fields in <code>state</code> to those in <code>predictands</code> and <code>tracerpredictands</code> by dispatching to specific methods.</p><pre><code class="language-julia hljs">reset_predictands!(state::State, tracerpredictands::TracerPredictands)</code></pre><p>Reset fields in <code>state.tracer.tracerpredictands</code> to those in <code>tracerpredictands</code>.</p><pre><code class="language-julia hljs">reset_predictands!(
    state::State,
    predictands::Predictands,
    model::Union{Boussinesq, PseudoIncompressible},
)</code></pre><p>Reset the density, density fluctuations and wind components in <code>state.variables.predictands</code> to those in <code>predictands</code>.</p><pre><code class="language-julia hljs">reset_predictands!(state::State, predictands::Predictands, model::Compressible)</code></pre><p>Reset the density, density fluctuations, wind components, Exner pressure and mass-weighted potential temperature (i.e. all fields) in <code>state.variables.predictands</code> to those in <code>predictands</code>.</p><p><strong>Arguments</strong></p><ul><li><p><code>state</code>: Model state.</p></li><li><p><code>predictands</code>: Fields to reset to.</p></li><li><p><code>tracerpredictands</code>: Tracer fields to reset to.</p></li><li><p><code>model</code>: Dynamic equations.</p></li></ul></div></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="PinCFlow.Integration.save_backups!" href="#PinCFlow.Integration.save_backups!"><code>PinCFlow.Integration.save_backups!</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">save_backups!(state::State, variables::Vararg{Symbol})</code></pre><p>Copy the specified fields in <code>state.variables.predictands</code> to their counterparts in <code>state.variables.backups</code>.</p><p><strong>Arguments</strong></p><ul><li><p><code>state</code>: Model state.</p></li><li><p><code>variables</code>: Names of the fields to create backups of.</p></li></ul></div></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="PinCFlow.Integration.synchronize_compressible_atmosphere!" href="#PinCFlow.Integration.synchronize_compressible_atmosphere!"><code>PinCFlow.Integration.synchronize_compressible_atmosphere!</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">synchronize_compressible_atmosphere!(state::State, predictands::Predictands)</code></pre><p>Synchronize <code>state.atmosphere.pbar</code> with <code>predictands.p</code> if the atmosphere is compressible by dispatching to the appropriate method.</p><pre><code class="language-julia hljs">synchronize_compressible_atmosphere!(
    state::State,
    predictands::Predictands,
    model::Union{Boussinesq, PseudoIncompressible},
)</code></pre><p>Return in non-compressible modes.</p><pre><code class="language-julia hljs">synchronize_compressible_atmosphere!(
    state::State,
    predictands::Predictands,
    model::Compressible,
)</code></pre><p>Synchronize <code>state.atmosphere.pbar</code> with <code>predictands.p</code>.</p><p>In compressible mode, <span>$P$</span> is time-dependent. In the update of <span>$P$</span>, only <code>state.variables.predictands.p</code> is changed, so that the old values of <span>$P$</span> are retained in the respective field of <code>state.atmosphere</code>. When these are no longer needed, this method is used to update the field accordingly.</p><p><strong>Arguments</strong></p><ul><li><p><code>state</code>: Model state.</p></li><li><p><code>predictands</code>: Predictands to use for the synchronization of the mass-weighted potential temperature.</p></li><li><p><code>model</code>: Dynamic equations.</p></li></ul></div></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="PinCFlow.Integration.synchronize_density_fluctuations!" href="#PinCFlow.Integration.synchronize_density_fluctuations!"><code>PinCFlow.Integration.synchronize_density_fluctuations!</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">synchronize_density_fluctuations!(state::State)</code></pre><p>Synchronize the density fluctuations in <code>state.variables.predictands.rhop</code> with the density in <code>state.variables.predictands.rho</code> by dispatching to a model-specific method.</p><pre><code class="language-julia hljs">synchronize_density_fluctuations!(state::State, model::Boussinesq)</code></pre><p>Return in Boussinesq mode.</p><p>In Boussinesq mode, density fluctuations don&#39;t require synchronization, since the density is assumed constant except in the buoyancy equation.</p><pre><code class="language-julia hljs">synchronize_density_fluctuations!(state::State, model::PseudoIncompressible)</code></pre><p>Synchronize the density fluctuations in <code>state.variables.predictands.rhop</code> with the density in <code>state.variables.predictands.rho</code>.</p><p>The density fluctuations are defined as the product of the mass-weighted potential temperature and the fluctuations of the inverse potential temperature. In pseudo-incompressible mode, <span>$P$</span> is constant, so that this is reduced to the difference between <span>$\rho$</span> and <span>$\overline{\rho}$</span>, i.e.</p><p class="math-container">\[\rho&#39; = \frac{P}{\theta} - \frac{P}{\overline{\theta}} = \rho - \overline{\rho}.\]</p><pre><code class="language-julia hljs">synchronize_density_fluctuations!(state::State, model::Compressible)</code></pre><p>Synchronize the density fluctuations in <code>state.variables.predictands.rhop</code> with the density in <code>state.variables.predictands.rho</code>.</p><p>In compressible mode, <span>$P$</span> is time-dependent, so that the density fluctuations are not reduced to the difference between <span>$\rho$</span> and <span>$\overline{\rho}$</span>, i.e.</p><p class="math-container">\[\rho&#39; = \frac{P}{\theta} - \frac{P}{\overline{\theta}} = \rho - \frac{P}{\overline{\theta}}.\]</p><p><strong>Arguments</strong></p><ul><li><p><code>state</code>: Model state.</p></li><li><p><code>model</code>: Dynamic equations.</p></li></ul></div></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="PinCFlow.Integration.wkb_integration!" href="#PinCFlow.Integration.wkb_integration!"><code>PinCFlow.Integration.wkb_integration!</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">wkb_integration!(state::State, dtstage::AbstractFloat)</code></pre><p>Use MSGWaM to update the properties of the unresolved gravity-wave field and compute its impact on the resolved flow.</p><p>In the first step, MSGWaM&#39;s saturation scheme is applied to account for the impact of wave breaking on the wave-action field. Next, the ray volumes are propagated via integration of the ray equations with a Runge-Kutta time step. Ray volumes that have grown larger than the cells of the model grid are then split before their array positions are shifted such that they are attributed to the correct grid cells. Afterwards, ray volumes are merged in cells where their count exceeds a specified threshold. Finally, the ray volumes in boundary and halo cells are updated and the mean-flow impact is calculated.</p><p><strong>Arguments</strong></p><ul><li><p><code>state</code>: Model state.</p></li><li><p><code>dtstage</code>: Time step.</p></li></ul></div></section></article></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../msgwam/">« MSGWaM</a><a class="docs-footer-nextpage" href="../output/">Output »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.14.1 on <span class="colophon-date" title="Thursday 16 October 2025 12:10">Thursday 16 October 2025</span>. Using Julia version 1.10.10.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
