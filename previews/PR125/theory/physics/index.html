<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Physics · PinCFlow.jl</title><meta name="title" content="Physics · PinCFlow.jl"/><meta property="og:title" content="Physics · PinCFlow.jl"/><meta property="twitter:title" content="Physics · PinCFlow.jl"/><meta name="description" content="Documentation for PinCFlow.jl."/><meta property="og:description" content="Documentation for PinCFlow.jl."/><meta property="twitter:description" content="Documentation for PinCFlow.jl."/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">PinCFlow.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../../examples/mountain_wave_simulation/">Mountain-wave simulation</a></li><li><a class="tocitem" href="../../examples/wkb_mountain_wave_simulation/">WKB mountain-wave simulation</a></li></ul></li><li><span class="tocitem">Theory</span><ul><li class="is-active"><a class="tocitem" href>Physics</a><ul class="internal"><li><a class="tocitem" href="#Coordinate-system"><span>Coordinate system</span></a></li><li><a class="tocitem" href="#Pseudo-incompressible-equations"><span>Pseudo-incompressible equations</span></a></li><li><a class="tocitem" href="#Boussinesq-equations"><span>Boussinesq equations</span></a></li><li><a class="tocitem" href="#Compressible-equations"><span>Compressible equations</span></a></li><li><a class="tocitem" href="#Tracer-transport"><span>Tracer transport</span></a></li><li><a class="tocitem" href="#MS-GWaM"><span>MS-GWaM</span></a></li></ul></li><li><a class="tocitem" href="../numerics/">Numerics</a></li></ul></li><li><span class="tocitem">Reference</span><ul><li><a class="tocitem" href="../../reference/pincflow/">PinCFlow</a></li><li><a class="tocitem" href="../../reference/types/">Types</a></li><li><a class="tocitem" href="../../reference/mpi_operations/">MPIOperations</a></li><li><a class="tocitem" href="../../reference/boundaries/">Boundaries</a></li><li><a class="tocitem" href="../../reference/flux_calculator/">FluxCalculator</a></li><li><a class="tocitem" href="../../reference/poisson_solver/">PoissonSolver</a></li><li><a class="tocitem" href="../../reference/update/">Update</a></li><li><a class="tocitem" href="../../reference/msgwam/">MSGWaM</a></li><li><a class="tocitem" href="../../reference/integration/">Integration</a></li><li><a class="tocitem" href="../../reference/output/">Output</a></li></ul></li><li><a class="tocitem" href="../../developer_guide/">Developer guide</a></li><li><a class="tocitem" href="../../changelog/">Changelog</a></li><li><a class="tocitem" href="../../authors/">Authors</a></li><li><a class="tocitem" href="../../contributing/">Contributing</a></li><li><a class="tocitem" href="../../code_of_conduct/">Code of Conduct</a></li><li><a class="tocitem" href="../../license/">License</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Theory</a></li><li class="is-active"><a href>Physics</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Physics</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/Atmospheric-Dynamics-GUF/PinCFlow.jl.git" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Physics"><a class="docs-heading-anchor" href="#Physics">Physics</a><a id="Physics-1"></a><a class="docs-heading-anchor-permalink" href="#Physics" title="Permalink"></a></h1><h2 id="Coordinate-system"><a class="docs-heading-anchor" href="#Coordinate-system">Coordinate system</a><a id="Coordinate-system-1"></a><a class="docs-heading-anchor-permalink" href="#Coordinate-system" title="Permalink"></a></h2><p>PinCFlow.jl uses a height-based terrain-following coordinate system (<a href="https://doi.org/10.1016/0021-9991(75)90037-6">Gal-Chen &amp; Somerville, 1975</a>) with vertical stretching. The transformation from the Cartesian system <span>$\boldsymbol{x} = \left(x, y, z\right)^\mathrm{T}$</span> to the model&#39;s system <span>$\widehat{\boldsymbol{x}} = \left(\widehat{x}, \widehat{y}, \widehat{z}\right)^\mathrm{T}$</span> is given by</p><p class="math-container">\[\begin{align*}
    \widehat{z} &amp; = \widehat{z} \left(\widetilde{z}\right), &amp; \left(\widehat{x}, \widehat{y}, \widetilde{z}\right) &amp; = \left(x, y, L_z \frac{z - h}{L_z - h}\right), &amp;  \left(x, y, z\right) &amp; = \left(\widehat{x}, \widehat{y}, \frac{L_z - h}{L_z}{\widetilde{z}} + h\right),
\end{align*}\]</p><p>where <span>$L_z$</span> is the vertical extent of the model domain and <span>$h$</span> is the surface topography. The contravariant basis vectors of the transformed system are</p><p class="math-container">\[\begin{align*}
    \boldsymbol{\epsilon}^{\widehat{x}} &amp; = \boldsymbol{e}^x, &amp; \boldsymbol{\epsilon}^{\widehat{y}} &amp; = \boldsymbol{e}^y, &amp; \boldsymbol{\epsilon}^{\widehat{z}} = \frac{\partial h}{\partial \widehat{x}} \frac{\widetilde{z} - L_z}{L_z - h} \frac{\partial \widehat{z}}{\partial \widetilde{z}} \boldsymbol{e}^x + \frac{\partial h}{\partial y} \frac{\widetilde{z} - L_z}{L_z - h} \frac{\partial \widehat{z}}{\partial \widetilde{z}} \boldsymbol{e}^y + \frac{L_z}{L_z - h} \frac{\partial \widehat{z}}{\partial \widetilde{z}}\boldsymbol{e}^z.
\end{align*}\]</p><p>The scalar products of these yield the metric tensor</p><p class="math-container">\[G^{\mu \nu} = \begin{pmatrix}
    1 &amp; 0 &amp; \frac{\partial h}{\partial x} \frac{\widetilde{z} - L_z}{L_z - h} \frac{\partial \widehat{z}}{\partial \widetilde{z}}\\
    0 &amp; 1 &amp; \frac{\partial h}{\partial y} \frac{\widetilde{z} - L_z}{L_z - h} \frac{\partial \widehat{z}}{\partial \widetilde{z}}\\
    \frac{\partial h}{\partial x} \frac{\widetilde{z} - L_z}{L_z - h} \frac{\partial \widehat{z}}{\partial \widetilde{z}} &amp; \frac{\partial h}{\partial y} \frac{\widetilde{z} - L_z}{L_z - h} \frac{\partial \widehat{z}}{\partial \widetilde{z}} &amp; \left\{\left(\frac{L_z}{L_z - h}\right)^2 + \left(\frac{\widetilde{z} - L_z}{L_z - h}\right)^2 \left[\left(\frac{\partial h}{\partial x}\right)^2 + \left(\frac{\partial h}{\partial y}\right)^2\right]\right\} \left(\frac{\partial \widehat{z}}{\partial \widetilde{z}}\right)^2
\end{pmatrix},\]</p><p>from which the Jacobian</p><p class="math-container">\[J = \frac{L_z - h} {L_z} \frac{\partial \widetilde{z}}{\partial \widehat{z}}\]</p><p>can be determined. Finally, the transformation rule for the wind reads</p><p class="math-container">\[\left(\widehat{u}, \widehat{v}, \widehat{w}\right) = \left(u, v, G^{13} u + G^{23} v + J^{- 1} w\right).\]</p><h2 id="Pseudo-incompressible-equations"><a class="docs-heading-anchor" href="#Pseudo-incompressible-equations">Pseudo-incompressible equations</a><a id="Pseudo-incompressible-equations-1"></a><a class="docs-heading-anchor-permalink" href="#Pseudo-incompressible-equations" title="Permalink"></a></h2><p>The atmosphere is decomposed into a hydrostatic background and deviations from it, specifically</p><p class="math-container">\[\begin{align*}
    \pi \left(\boldsymbol{x}, t\right) &amp; = \overline{\pi} \left(z\right) + \pi&#39; \left(\boldsymbol{x}, t\right),\\
    \theta \left(\boldsymbol{x}, t\right) &amp; = \overline{\theta} \left(z\right) + \theta&#39; \left(\boldsymbol{x}, t\right),
\end{align*}\]</p><p>where <span>$\pi$</span>, <span>$\theta$</span> and <span>$t$</span> denote the Exner-pressure, potential temperature and time, respectively, and the background satisfies</p><p class="math-container">\[\begin{align*}
    \overline{\pi} \left(0\right) = 1, &amp;&amp; \frac{\mathrm{d} \overline{\pi}}{\mathrm{d} z} = - \frac{g}{c_p} \overline{\theta}^{- 1},
\end{align*}\]</p><p>with <span>$g$</span> and <span>$c_p$</span> being the gravitational acceleration and specific heat capacity at constant pressure, respectively (<a href="https://doi.org/10.1175/mwr-d-19-0073.1">Benacchio &amp; Klein, 2019</a>). Using this decomposition, the model equations in pseudo-incompressible mode are written as</p><p class="math-container">\[{\small\begin{align*}
    \frac{\partial \rho}{\partial t} + \frac{1}{J} \left(\frac{\partial J \rho u}{\partial \widehat{x}} + \frac{\partial J \rho v}{\partial \widehat{y}} + \frac{\partial J \rho \widehat{w}}{\partial \widehat{z}}\right) + \alpha_\mathrm{R} \left(\rho - \overline{\rho}\right) &amp; = 0,\\
    \frac{\partial \rho&#39;}{\partial t} + \frac{1}{J} \left(\frac{\partial J \rho&#39; u}{\partial \widehat{x}} + \frac{\partial J \rho&#39; v}{\partial \widehat{y}} + \frac{\partial J \rho&#39; \widehat{w}}{\partial \widehat{z}}\right) + \alpha_\mathrm{R} \rho&#39; &amp; = \frac{N^2 \overline{\rho} w}{g},\\
    \frac{1}{J} \left(\frac{\partial J P u}{\partial \widehat{x}} + \frac{\partial J P v}{\partial \widehat{y}} + \frac{\partial J P \widehat{w}}{\partial \widehat{z}}\right) &amp; = 0,\\
    \frac{\partial \rho u}{\partial t} + \mathcal{A}^{\rho u} - \mathcal{V}^{\rho u} - \mathcal{X}^{\rho u} - f \rho v + \alpha_\mathrm{R} \left(u - u_\mathrm{R}\right) &amp; = - c_p P \mathcal{P}^{\rho u} - \beta_\mathrm{R} \rho u + F^{\rho u},\\
    \frac{\partial \rho v}{\partial t} + \mathcal{A}^{\rho v} - \mathcal{V}^{\rho v} - \mathcal{X}^{\rho v} + f \rho u + \alpha_\mathrm{R} \left(v - v_\mathrm{R}\right) &amp; = - c_p P \mathcal{P}^{\rho v} - \beta_\mathrm{R} \rho v + F^{\rho v},\\
    \frac{\partial \rho \widehat{w}}{\partial t} + \mathcal{A}^{\rho \widehat{w}} - \mathcal{V}^{\rho \widehat{w}} - \mathcal{X}^{\rho \widehat{w}} - G^{13} f \rho v + G^{23} f \rho u + \alpha_\mathrm{R} \left(\widehat{w} - \widehat{w}_\mathrm{R}\right) &amp; = - c_p P \mathcal{P}^{\rho \widehat{w}} - \frac{g \rho&#39;}{J} - \beta_\mathrm{R} \rho \widehat{w} + F^{\rho \widehat{w}},
\end{align*}}\]</p><p>where <span>$\rho \left(\boldsymbol{x}, t\right) = \overline{\rho} \left(z\right) + \rho&#39; \left(\boldsymbol{x}, t\right)$</span> is the density, <span>$P = \rho \theta = \overline{\rho} \overline{\theta}$</span> is the mass-weighted potential temperature, <span>$N^2 = \left(g / \overline{\theta}\right) \left(\mathrm{d} \overline{\theta} / \mathrm{d} z\right)$</span> is the squared buoyancy frequency and <span>$f = f_0$</span> is the Coriolis frequency. On the left-hand sides, <span>$\alpha_\mathrm{R}$</span> and <span>$\left(u_\mathrm{R}, v_\mathrm{R}, \widehat{w}_\mathrm{R}\right)^\mathrm{R}$</span> represent the Rayleigh-damping coefficient of a customizable sponge and the transformed wind that is to be obtained via the relaxation in it. In contrast, the Rayleigh-damping coefficient <span>$\beta_\mathrm{R}$</span> on the right-hand side implements a preset sponge. The terms <span>$\left(F^{\rho u}, F^{\rho v}, F^{\rho \widehat{w}}\right)^\mathrm{T}$</span> represent volume forces in the momentum equation, e.g. drag imposed by unresolved gravity waves. The advective momentum-flux divergences are given by</p><p class="math-container">\[\begin{align*}
    \mathcal{A}^{\rho u} &amp; = \frac{1}{J} \left(\frac{\partial J \rho u u}{\partial \widehat{x}} + \frac{\partial J \rho u v}{\partial \widehat{y}} + \frac{\partial J \rho u \widehat{w}}{\partial \widehat{z}}\right),\\
    \mathcal{A}^{\rho v} &amp; = \frac{1}{J} \left(\frac{\partial J \rho v u}{\partial \widehat{x}} + \frac{\partial J \rho v v}{\partial \widehat{y}} + \frac{\partial J \rho v \widehat{w}}{\partial \widehat{z}}\right),\\
    \mathcal{A}^{\rho \widehat{w}} &amp; = G^{13} \mathcal{A}^{\rho u} + G^{23} \mathcal{A}^{\rho v} + \frac{1}{J^2} \left(\frac{\partial J \rho w u}{\partial \widehat{x}} + \frac{\partial J \rho w v}{\partial \widehat{y}} + \frac{\partial J \rho w \widehat{w}}{\partial \widehat{z}}\right)
\end{align*}\]</p><p>and the viscous-flux divergences are</p><p class="math-container">\[\begin{align*}
    \mathcal{V}^{\rho u} &amp; = \frac{1}{J} \left(\frac{\partial J \eta \widehat{\Pi}^{11}}{\partial \widehat{x}} + \frac{\partial J \eta \widehat{\Pi}^{12}}{\partial \widehat{y}} + \frac{\partial J \eta \widehat{\Pi}^{13}}{\partial \widehat{z}}\right),\\
    \mathcal{V}^{\rho v} &amp; = \frac{1}{J} \left(\frac{\partial J \eta \widehat{\Pi}^{21}}{\partial \widehat{x}} + \frac{\partial J \eta \widehat{\Pi}^{22}}{\partial \widehat{y}} + \frac{\partial J \eta \widehat{\Pi}^{23}}{\partial \widehat{z}}\right),\\
    \mathcal{V}^{\rho \widehat{w}} &amp; = G^{13} \mathcal{V}^{\rho u} + G^{23} \mathcal{V}^{\rho v} + \frac{1}{J^2} \left[\frac{\partial J \eta \Pi^{31}}{\partial \widehat{x}} + \frac{\partial J \eta \Pi^{32}}{\partial \widehat{y}} + \frac{\partial}{\partial \widehat{z}} \left(J G^{13} \eta \Pi^{13} + J G^{23} \eta \Pi^{23} + \eta \Pi^{33}\right)\right].
\end{align*}\]</p><p>Therein, <span>$\eta$</span> is the dynamic shear viscosity, the elements of the (symmetric) transformed stress tensor are given by</p><p class="math-container">\[\begin{align*}
    \widehat{\Pi}^{11} &amp; = \Pi^{11},\\
    \widehat{\Pi}^{12} &amp; = \Pi^{12},\\
    \widehat{\Pi}^{22} &amp; = \Pi^{22},\\
    \widehat{\Pi}^{13} &amp; = G^{13} \Pi^{11} + G^{23} \Pi^{12} + \frac{1}{J} \Pi^{13},\\
    \widehat{\Pi}^{23} &amp; = G^{13} \Pi^{12} + G^{23} \Pi^{22} + \frac{1}{J} \Pi^{23},\\
    \widehat{\Pi}^{33} &amp; = \left(G^{13}\right)^2 \Pi^{11} + \left(G^{23}\right)^2 \Pi^{22} + \frac{1}{J^2} \Pi^{33} + 2 \left(G^{13} G^{23} \Pi^{12} + \frac{G^{13}}{J} \Pi^{13} + \frac{G^{23}}{J} \Pi^{23}\right)
\end{align*}\]</p><p>and those of its Cartesian counterpart are</p><p class="math-container">\[\begin{align*}
    \Pi^{11} &amp; = 2 \left(\frac{\partial u}{\partial \widehat{x}} + G^{13} \frac{\partial u}{\partial \widehat{z}}\right) - \frac{2}{3 J} \left(\frac{\partial J u}{\partial \widehat{x}} + \frac{\partial J v}{\partial \widehat{y}} + \frac{\partial J \widehat{w}}{\partial \widehat{z}}\right),\\
    \Pi^{12} &amp; = \frac{\partial u}{\partial \widehat{y}} + G^{23} \frac{\partial u}{\partial \widehat{z}} + \frac{\partial v}{\partial \widehat{x}} + G^{13} \frac{\partial v}{\partial \widehat{z}},\\
    \Pi^{13} &amp; = \frac{1}{J} \frac{\partial u}{\partial \widehat{z}} + \frac{\partial w}{{\partial \widehat{x}}} + G^{13} \frac{\partial w}{\partial \widehat{z}},\\
    \Pi^{22} &amp; = 2 \left(\frac{\partial v}{{\partial \widehat{y}}} + G^{23} \frac{\partial v}{\partial \widehat{z}}\right) - \frac{2}{3 J} \left(\frac{\partial J u}{\partial \widehat{x}} + \frac{\partial J v}{\partial \widehat{y}} + \frac{\partial J \widehat{w}}{\partial \widehat{z}}\right),\\
    \Pi^{23} &amp; = \frac{1}{J} \frac{\partial v}{\partial \widehat{z}} + \frac{\partial w}{\partial \widehat{y}} + G^{23} \frac{\partial w}{\partial \widehat{z}},\\
    \Pi^{33} &amp; = \frac{2}{J} \frac{\partial w}{\partial \widehat{z}} - \frac{2}{3 J} \left(\frac{\partial J u}{\partial \widehat{x}} + \frac{\partial J v}{\partial \widehat{y}} + \frac{\partial J \widehat{w}}{\partial \widehat{z}}\right).
\end{align*}\]</p><p>In addition, artificial diffusion is represented by</p><p class="math-container">\[\begin{align*}
    \mathcal{X}^{\rho u} &amp; = \frac{1}{J} \left[\frac{\partial J \mu \widehat{\left(\boldsymbol{\nabla} u\right)}^{\widehat{x}}}{\partial \widehat{x}} + \frac{\partial J \mu \widehat{\left(\boldsymbol{\nabla} u\right)}^{\widehat{y}}}{\partial \widehat{y}} + \frac{\partial J \mu \widehat{\left(\boldsymbol{\nabla} u\right)}^{\widehat{z}}}{\partial \widehat{z}}\right],\\
    \mathcal{X}^{\rho v} &amp; = \frac{1}{J} \left[\frac{\partial J \mu \widehat{\left(\boldsymbol{\nabla} v\right)}^{\widehat{x}}}{\partial \widehat{x}} + \frac{\partial J \mu \widehat{\left(\boldsymbol{\nabla} v\right)}^{\widehat{y}}}{\partial \widehat{y}} + \frac{\partial J \mu \widehat{\left(\boldsymbol{\nabla} v\right)}^{\widehat{z}}}{\partial \widehat{z}}\right),\\
    \mathcal{X}^{\rho \widehat{w}} &amp; = G^{13} \mathcal{X}^{\rho u} + G^{23} \mathcal{X}^{\rho v} + \frac{1}{J^2} \left[\frac{\partial J \mu \widehat{\left(\boldsymbol{\nabla} w\right)}^{\widehat{x}}}{\partial \widehat{x}} + \frac{\partial J \mu \widehat{\left(\boldsymbol{\nabla} w\right)}^{\widehat{y}}}{\partial \widehat{y}} + \frac{\partial J \mu \widehat{\left(\boldsymbol{\nabla} w\right)}^{\widehat{z}}}{\partial \widehat{z}}\right],
\end{align*}\]</p><p>where <span>$\mu$</span> is the momentum-diffusion coefficient and</p><p class="math-container">\[\begin{align*}
    \widehat{\left(\boldsymbol{\nabla} \phi\right)}^{\widehat{x}} &amp; = \frac{\partial \phi}{\partial \widehat{x}} + G^{13} \frac{\partial \phi}{\partial \widehat{z}},\\
    \widehat{\left(\boldsymbol{\nabla} \phi\right)}^{\widehat{y}} &amp; = \frac{\partial \phi}{\partial \widehat{y}} + G^{23} \frac{\partial \phi}{\partial \widehat{z}},\\
    \widehat{\left(\boldsymbol{\nabla} \phi\right)}^{\widehat{z}} &amp; = G^{13}\frac{\partial \phi}{\partial \widehat{x}} + G^{23} \frac{\partial \phi}{\partial \widehat{y}} + G^{33}\frac{\partial \phi}{\partial \widehat{z}}.
\end{align*}\]</p><p>Analogously, the components of the pressure gradient are given by</p><p class="math-container">\[\begin{align*}
    \mathcal{P}^{\rho u} &amp; = \frac{\partial \pi&#39;}{\partial \widehat{x}} + G^{13} \frac{\partial \pi&#39;}{\partial \widehat{z}},\\
    \mathcal{P}^{\rho v} &amp; = \frac{\partial \pi&#39;}{\partial \widehat{y}} + G^{23} \frac{\partial \pi&#39;}{\partial \widehat{z}},\\
    \mathcal{P}^{\rho \widehat{w}} &amp; = G^{13} \frac{\partial \pi&#39;}{\partial \widehat{x}} + G^{23} \frac{\partial \pi&#39;}{\partial \widehat{y}} + G^{33} \frac{\partial \pi&#39;}{\partial \widehat{z}}
\end{align*}\]</p><p>(see <a href="https://doi.org/10.1175/mwr-d-12-00026.1">Rieper et al., 2013</a>; <a href="https://doi.org/10.1175/MWR-D-21-0126.1">Schmid et al., 2021</a>).</p><h2 id="Boussinesq-equations"><a class="docs-heading-anchor" href="#Boussinesq-equations">Boussinesq equations</a><a id="Boussinesq-equations-1"></a><a class="docs-heading-anchor-permalink" href="#Boussinesq-equations" title="Permalink"></a></h2><p>In Boussinesq mode, the continuity equation is removed and the density fluctuations are set to zero everywhere except in the auxiliary equation and the buoyancy term of the transformed-vertical-momentum equation. Moreover, <span>$\overline{\rho}$</span>, <span>$\overline{\theta}$</span>, <span>$P$</span> and <span>$N^2$</span> are replaced with the constant reference values <span>$\rho_0$</span>, <span>$\theta_0$</span>, <span>$P_0$</span> and <span>$N_0^2$</span>.</p><h2 id="Compressible-equations"><a class="docs-heading-anchor" href="#Compressible-equations">Compressible equations</a><a id="Compressible-equations-1"></a><a class="docs-heading-anchor-permalink" href="#Compressible-equations" title="Permalink"></a></h2><p>In compressible mode, the identity <span>$P = \overline{\rho} \overline{\theta}$</span> no longer holds, i.e. the mass-weighted potential temperature has a spatiotemporal dependence. The divergence constraint is thus replaced with the prognostic equation</p><p class="math-container">\[\frac{\partial P}{\partial t} + \frac{1}{J} \left(\frac{\partial J P u}{\partial \widehat{x}} + \frac{\partial J P v}{\partial \widehat{y}} + \frac{\partial J P \widehat{w}}{\partial \widehat{z}}\right) - F^P + \alpha_\mathrm{R} P \left(1 - \frac{\overline{\rho}}{\rho}\right) = 0,\]</p><p>where the volume force <span>$F^P$</span> represents a diabatic heating (e.g. due to heat conduction or unresolved gravity waves) that is not allowed in pseudo-incompressible mode. This term must also be represented in the auxiliary equation, which now reads</p><p class="math-container">\[\frac{\partial \rho&#39;}{\partial t} + \frac{1}{J} \left(\frac{\partial J \rho&#39; u}{\partial \widehat{x}} + \frac{\partial J \rho&#39; v}{\partial \widehat{y}} + \frac{\partial J \rho&#39; \widehat{w}}{\partial \widehat{z}}\right) + \frac{F^P}{\overline{\theta}} + \alpha_\mathrm{R} \left[\rho&#39; - \overline{\rho} \left(1 - \frac{P}{\rho \overline{\theta}}\right)\right] = \frac{N^2 P w}{g \overline{\theta}}.\]</p><p>Note that in addition to the new volume-force term, <span>$\overline{\rho}$</span> has been replaced with <span>$P / \overline{\theta}$</span>, which is due to the density fluctuations being defined as <span>$\rho&#39; = \rho - P / \overline{\theta}$</span> (<a href="https://doi.org/10.1175/mwr-d-19-0073.1">Benacchio &amp; Klein, 2019</a>).</p><h2 id="Tracer-transport"><a class="docs-heading-anchor" href="#Tracer-transport">Tracer transport</a><a id="Tracer-transport-1"></a><a class="docs-heading-anchor-permalink" href="#Tracer-transport" title="Permalink"></a></h2><p>PinCFlow.jl transports a passive tracer <span>$\chi$</span> governed by</p><p class="math-container">\[\frac{\partial \rho \chi}{\partial t} + \frac{1}{J} \left(\frac{\partial J \rho \chi u}{\partial \widehat{x}} + \frac{\partial J \rho \chi v}{\partial \widehat{y}} + \frac{\partial J \rho \chi \widehat{w}}{\partial \widehat{z}}\right) - F^{\rho \chi} + \alpha_\mathrm{R} \left[\rho \chi - \left(\rho \chi\right)^{\left(0\right)}\right] = 0,\]</p><p>where <span>$F^{\rho \chi}$</span> represents another volume force, e.g. a tracer-flux divergence due to unresolved gravity waves, and <span>$\left(\rho \chi\right)^{\left(0\right)}$</span> is the initial mass-weighted tracer.</p><h2 id="MS-GWaM"><a class="docs-heading-anchor" href="#MS-GWaM">MS-GWaM</a><a id="MS-GWaM-1"></a><a class="docs-heading-anchor-permalink" href="#MS-GWaM" title="Permalink"></a></h2><h3 id="3D-transient-theory"><a class="docs-heading-anchor" href="#3D-transient-theory">3D transient theory</a><a id="3D-transient-theory-1"></a><a class="docs-heading-anchor-permalink" href="#3D-transient-theory" title="Permalink"></a></h3><p>The gravity-wave dispersion relation is written as <span>$\omega \left(\boldsymbol{x}, t\right) = \Omega \left[\boldsymbol{x}, t, \boldsymbol{k} \left(\boldsymbol{x}, t\right)\right]$</span>, where in</p><p class="math-container">\[\Omega \left(\boldsymbol{x}, t, \boldsymbol{k}\right) = \boldsymbol{k} \cdot \boldsymbol{u}_\mathrm{b} \pm \sqrt{\frac{N^2 \left(z\right) \left(k^2 + l^2\right) + f^2 m^2}{\left|\boldsymbol{k}\right|^2}},\]</p><p>the spatiotemporal dependence is split into an explicit part due to variations in the (resolved) background wind <span>$\boldsymbol{u}_\mathrm{b} = \left(u_\mathrm{b}, v_\mathrm{b}, 0\right)^\mathrm{T}$</span> and the squared buoyancy frequency <span>$N^2$</span>, and an implicit part due to variations in the wavevector <span>$\boldsymbol{k} = \left(k, l, m\right)^\mathrm{T}$</span>. Using this decomposition, the eikonal equations are written as</p><p class="math-container">\[\begin{align*}
    \dot{\omega} &amp; = \left[\frac{\partial}{\partial t} + \boldsymbol{c}_\mathrm{g} \cdot \begin{pmatrix}
    \partial_{\widehat{x}} + G^{13} \partial_{\widehat{z}}\\
    \partial_{\widehat{y}} + G^{23} \partial_{\widehat{z}}\\
    J^{- 1} \partial_{\widehat{z}}
\end{pmatrix}\right] \omega = \frac{\partial \Omega}{\partial t},\\
\dot{\boldsymbol{k}} &amp; = \left[\frac{\partial}{\partial t} + \boldsymbol{c}_\mathrm{g} \cdot \begin{pmatrix}
    \partial_{\widehat{x}} + G^{13} \partial_{\widehat{z}}\\
    \partial_{\widehat{y}} + G^{23} \partial_{\widehat{z}}\\
    J^{- 1} \partial_{\widehat{z}}
\end{pmatrix}\right] \boldsymbol{k} = \begin{pmatrix}
    \partial_{\widehat{x}} + G^{13} \partial_{\widehat{z}}\\
    \partial_{\widehat{y}} + G^{23} \partial_{\widehat{z}}\\
    J^{- 1} \partial_{\widehat{z}}
\end{pmatrix} \Omega.
\end{align*}\]</p><p>They are integrated along rays defined by the group velocity</p><p class="math-container">\[\begin{align*}
    \dot{\boldsymbol{x}} = \boldsymbol{c}_\mathrm{g} = \boldsymbol{\nabla}_{\boldsymbol{k}} \Omega,
\end{align*}\]</p><p>where <span>$\boldsymbol{\nabla}_{\boldsymbol{k}} = \left(\partial_k, \partial_l, \partial_m\right)^\mathrm{T}$</span>. The gravity-wave energy is encoded in the phase-space wave-action density, which is governed by the equation</p><p class="math-container">\[\dot{\mathcal{N}} = \left[\frac{\partial}{\partial t} + \boldsymbol{c}_\mathrm{g} \cdot \begin{pmatrix}
    \partial_{\widehat{x}} + G^{13} \partial_{\widehat{z}}\\
    \partial_{\widehat{y}} + G^{23} \partial_{\widehat{z}}\\
    J^{- 1} \partial_{\widehat{z}}
\end{pmatrix} + \dot{\boldsymbol{k}} \cdot \boldsymbol{\nabla}_{\boldsymbol{k}}\right] \mathcal{N} = \sum\limits_s \mathcal{S}_s,\]</p><p>where <span>$\mathcal{S}_s$</span> are sinks and sources. This latter equation is integrated along rays defined by <span>$\left(\dot{\boldsymbol{x}}, \dot{\boldsymbol{k}}\right)^\mathrm{T}$</span>, so that <span>$\mathcal{N}$</span> is conserved if the right-hand side is zero. The impact of the unresolved gravity waves on the resolved flow is given by</p><p class="math-container">\[\begin{align*}
    \left(\frac{\partial \rho_\mathrm{b} u_\mathrm{b}}{\partial t}\right)_\mathrm{w} &amp; = - \frac{\rho_\mathrm{b}}{\overline{\rho}} \begin{pmatrix}
        \partial_{\widehat{x}} + G^{13} \partial_{\widehat{z}}\\
        \partial_{\widehat{y}} + G^{23} \partial_{\widehat{z}}\\
        J^{- 1} \partial_{\widehat{z}}
    \end{pmatrix} \cdot \left(\overline{\rho} \left\langle u&#39; \boldsymbol{u}&#39; \right\rangle\right) - \rho_\mathrm{b} \frac{f}{\overline{\theta}} \left\langle \theta&#39; v&#39; \right\rangle,\\
    \left(\frac{\partial \rho_\mathrm{b} v_\mathrm{b}}{\partial t}\right)_\mathrm{w} &amp; = - \frac{\rho_\mathrm{b}}{\overline{\rho}} \begin{pmatrix}
        \partial_{\widehat{x}} + G^{13} \partial_{\widehat{z}}\\
        \partial_{\widehat{y}} + G^{23} \partial_{\widehat{z}}\\
        J^{- 1} \partial_{\widehat{z}}
    \end{pmatrix} \cdot \left(\overline{\rho} \left\langle v&#39; \boldsymbol{u}&#39; \right\rangle\right) + \rho_\mathrm{b} \frac{f}{\overline{\theta}} \left\langle \theta&#39; u&#39; \right\rangle,\\
    \left(\frac{\partial \rho_\mathrm{b} \widehat{w}_\mathrm{b}}{\partial t}\right)_\mathrm{w} &amp; = G^{13} \left(\frac{\partial \rho_\mathrm{b} u_\mathrm{b}}{\partial t}\right)_\mathrm{w} + G^{23} \left(\frac{\partial \rho_\mathrm{b} v_\mathrm{b}}{\partial t}\right)_\mathrm{w},\\
    \left(\frac{\partial P_\mathrm{b}}{\partial t}\right)_\mathrm{w} &amp; = - \rho_\mathrm{b} \begin{pmatrix}
        \partial_{\widehat{x}} + G^{13} \partial_{\widehat{z}}\\
        \partial_{\widehat{y}} + G^{23} \partial_{\widehat{z}}\\
        0
    \end{pmatrix} \cdot \left\langle \theta&#39; \boldsymbol{u}&#39; \right\rangle,
\end{align*}\]</p><p>where <span>$\rho_\mathrm{b}$</span>, <span>$\widehat{\boldsymbol{u}}_\mathrm{b} = \left(u_\mathrm{b}, v_\mathrm{b}, \widehat{w}_\mathrm{b}\right)^\mathrm{T}$</span> and <span>$P_\mathrm{b}$</span> are the resolved density, transformed wind and mass-weighted potential temperature, respectively, and</p><p class="math-container">\[\begin{align*}
    \overline{\rho} \left\langle u&#39; u&#39; \right\rangle &amp; = \int \left[k \widehat{c}_{\mathrm{g} x} - \mathrm{sgn} \left(\left|f\right|\right) \frac{k \widehat{c}_{\mathrm{g} x} + l \widehat{c}_{\mathrm{g} y}}{1 - \left(\widehat{\omega} / f\right)^2}\right] \mathcal{N} \, \mathrm{d} V_{\boldsymbol{k}},\\
    \overline{\rho} \left\langle u&#39; v&#39; \right\rangle &amp; = \int l \widehat{c}_{\mathrm{g} x} \mathcal{N} \, \mathrm{d} V_{\boldsymbol{k}},\\
    \overline{\rho} \left\langle u&#39; w&#39; \right\rangle &amp; = \int \frac{k \widehat{c}_{\mathrm{g} z}}{1 - \left(f / \widehat{\omega}\right)^2} \mathcal{N} \, \mathrm{d} V_{\boldsymbol{k}},\\
    \overline{\rho} \left\langle v&#39; v&#39; \right\rangle &amp; = \int \left[l \widehat{c}_{\mathrm{g} y} - \mathrm{sgn} \left(\left|f\right|\right) \frac{k \widehat{c}_{\mathrm{g} x} + l \widehat{c}_{\mathrm{g} y}}{1 - \left(\widehat{\omega} / f\right)^2}\right] \mathcal{N} \, \mathrm{d} V_{\boldsymbol{k}},\\
    \overline{\rho} \left\langle v&#39; w&#39; \right\rangle &amp; = \int \frac{l \widehat{c}_{\mathrm{g} z}}{1 - \left(f / \widehat{\omega}\right)^2} \mathcal{N} \, \mathrm{d} V_{\boldsymbol{k}},\\
    \left\langle \theta&#39; u&#39; \right\rangle &amp; = \frac{f \overline{\theta}}{g \overline{\rho}} \int \frac{l m N^2}{\widehat{\omega} \left|\boldsymbol{k}\right|^2} \mathcal{N} \, \mathrm{d} V_{\boldsymbol{k}},\\
    \left\langle \theta&#39; v&#39; \right\rangle &amp; = - \frac{f \overline{\theta}}{g \overline{\rho}} \int \frac{k m N^2}{\widehat{\omega} \left|\boldsymbol{k}\right|^2} \mathcal{N} \, \mathrm{d} V_{\boldsymbol{k}},
\end{align*}\]</p><p>with <span>$\widehat{\omega} = \omega - \boldsymbol{k} \cdot \boldsymbol{u}_\mathrm{b}$</span>, <span>$\widehat{\boldsymbol{c}}_\mathrm{g} = \left(\widehat{c}_{\mathrm{g} x}, \widehat{c}_{\mathrm{g} y}, \widehat{c}_{\mathrm{g} z}\right)^\mathrm{T} = \boldsymbol{\nabla}_{\boldsymbol{k}} \widehat{\omega}$</span> and <span>$\mathrm{d} V_{\boldsymbol{k}} = \mathrm{d} k \mathrm{d} l \mathrm{d} m$</span> being the intrinsic frequency, intrinsic group velocity and spectral volume element, respectively (see <a href="https://doi.org/10.1002/qj.2926">Achatz et al., 2017</a>; <a href="https://doi.org/10.1063/5.0165180">Achatz et al., 2023</a>; <a href="https://doi.org/10.1175/JAS-D-24-0158.1">Jochum et al., 2025</a>).</p><h3 id="Wave-breaking"><a class="docs-heading-anchor" href="#Wave-breaking">Wave breaking</a><a id="Wave-breaking-1"></a><a class="docs-heading-anchor-permalink" href="#Wave-breaking" title="Permalink"></a></h3><p>Wave breaking is captured with a saturation scheme. This scheme assumes that static instability leads to turbulent fluxes that may be described by a turbulent viscosity and diffusivity <span>$K$</span> in a flux-gradient ansatz (see <a href="https://doi.org/10.1029/JC086iC10p09707">Lindzen, 1981</a>; <a href="https://doi.org/10.1016/j.jastp.2004.01.019">Becker, 2004</a>). The divergence of these fluxes has a damping effect on the phase-space wave-action density, which is represented by the sink</p><p class="math-container">\[\mathcal{S}_\mathrm{s} = - 2 K \left|\boldsymbol{k}\right|^2 \mathcal{N}.\]</p><p>This damping is assumed to be such that within one time step <span>$\Delta t$</span>, the instability criterion is no longer fulfilled, which implies</p><p class="math-container">\[K = \frac{\overline{\rho}}{4 \Delta t} \left[\int N^4 \left(k^2 + l^2\right) m^2 \frac{\mathcal{N}}{\widehat{\omega}} \, \mathrm{d} V_{\boldsymbol{k}}\right]^{- 1} \max \left[0, \frac{2}{\overline{\rho}} \int \frac{N^4 \left(k^2 + l^2\right) m^2}{\widehat{\omega} \left|\boldsymbol{k}\right|^2} \mathcal{N} \mathrm{d} V_{\boldsymbol{k}} - \alpha_\mathrm{s}^2 N^4\right],\]</p><p>where <span>$\alpha_\mathrm{s}$</span> is a saturation coefficient that accounts for uncertainties of the criterion (<a href="https://doi.org/10.1175/JAS-D-16-0069.1">Boeloeni et al., 2016</a>; <a href="https://doi.org/10.1175/JAS-D-20-0065.1">Boeloeni et al., 2021</a>).</p><h3 id="Rayleigh-damping"><a class="docs-heading-anchor" href="#Rayleigh-damping">Rayleigh damping</a><a id="Rayleigh-damping-1"></a><a class="docs-heading-anchor-permalink" href="#Rayleigh-damping" title="Permalink"></a></h3><p>The Rayleigh damping in the LHS sponge introduced above is represented by the sink</p><p class="math-container">\[\mathcal{S}_\mathrm{R} = - 2 \alpha_\mathrm{R} \mathcal{N}\]</p><p>in the phase-space-wave-action-density equation (<a href="https://doi.org/10.1175/JAS-D-24-0158.1">Jochum et al., 2025</a>).</p><h3 id="1D-transient-theory"><a class="docs-heading-anchor" href="#1D-transient-theory">1D transient theory</a><a id="1D-transient-theory-1"></a><a class="docs-heading-anchor-permalink" href="#1D-transient-theory" title="Permalink"></a></h3><p>The 3D transient theory can be reduced to a 1D transient one by removing all horizontal derivatives (in a Cartesian sense) and setting the horizontal components of the group velocity to zero. The eikonal equations then become</p><p class="math-container">\[\begin{align*}
    \dot{\omega} &amp; = \left(\frac{\partial}{\partial t} + \frac{c_{\mathrm{g} z}}{J} \frac{\partial}{\partial \widehat{z}}\right) \omega = \frac{\partial \Omega}{\partial t},\\
    \dot{m} &amp; = \left(\frac{\partial}{\partial t} + \frac{c_{\mathrm{g} z}}{J} \frac{\partial}{\partial \widehat{z}}\right) m = J^{- 1} \frac{\partial \Omega}{\partial \widehat{z}}
\end{align*}\]</p><p>and are integrated along rays defined by the vertical group velocity</p><p class="math-container">\[\dot{z} = c_{\mathrm{g} z} = \frac{\partial \Omega}{\partial m}.\]</p><p>The phase-space wave-action density equation is reduced to</p><p class="math-container">\[\dot{\mathcal{N}} = \left(\frac{\partial}{\partial t} + \frac{c_{\mathrm{g} z}}{J} \frac{\partial}{\partial \widehat{z}} + \dot{m} \frac{\partial}{\partial m}\right) \mathcal{N} = \sum\limits_s \mathcal{S}_s\]</p><p>and integrated along rays defined by <span>$\left(\dot{z}, \dot{m}\right)^\mathrm{T}$</span>. Finally, the impact on the resolved flow becomes</p><p class="math-container">\[\begin{align*}
    \left(\frac{\partial \rho_\mathrm{b} u_\mathrm{b}}{\partial t}\right)_\mathrm{w} &amp; = - \frac{\rho_\mathrm{b}}{J \overline{\rho}} \frac{\partial}{\partial \widehat{z}} \left(\overline{\rho} \left\langle u&#39; w&#39; \right\rangle\right) - \rho_\mathrm{b} \frac{f}{\overline{\theta}} \left\langle \theta&#39; v&#39; \right\rangle,\\
    \left(\frac{\partial \rho_\mathrm{b} v_\mathrm{b}}{\partial t}\right)_\mathrm{w} &amp; = - \frac{\rho_\mathrm{b}}{J \overline{\rho}} \frac{\partial}{\partial \widehat{z}} \left(\overline{\rho} \left\langle v&#39; w&#39; \right\rangle\right) + \rho_\mathrm{b} \frac{f}{\overline{\theta}} \left\langle \theta&#39; u&#39; \right\rangle,\\
    \left(\frac{\partial \rho_\mathrm{b} \widehat{w}_\mathrm{b}}{\partial t}\right)_\mathrm{w} &amp; = G^{13} \left(\frac{\partial \rho_\mathrm{b} u_\mathrm{b}}{\partial t}\right)_\mathrm{w} + G^{23} \left(\frac{\partial \rho_\mathrm{b} v_\mathrm{b}}{\partial t}\right)_\mathrm{w},\\
    \left(\frac{\partial P_\mathrm{b}}{\partial t}\right)_\mathrm{w} &amp; = 0
\end{align*}\]</p><p>(e.g. <a href="https://doi.org/10.1175/JAS-D-16-0069.1">Boeloeni et al., 2016</a>; <a href="https://doi.org/10.1175/JAS-D-20-0065.1">Boeloeni et al., 2021</a>).</p><h3 id="1D-steady-state-theory"><a class="docs-heading-anchor" href="#1D-steady-state-theory">1D steady-state theory</a><a id="1D-steady-state-theory-1"></a><a class="docs-heading-anchor-permalink" href="#1D-steady-state-theory" title="Permalink"></a></h3><p>In the 1D steady-state theory, the phase-space-wave-action-density equation from the previous section is integrated over spectral space, the temporal derivative is removed and the quasilinear approximation is used to express the result in terms of the physical-space wave-action densities of individual spectral modes (<span>$\mathcal{A}_\alpha$</span>). This yields</p><p class="math-container">\[J^{- 1} \frac{\partial}{\partial \widehat{z}} \left(c_{\mathrm{g} z, \alpha} \mathcal{A}_\alpha\right) = \sum\limits_s \mathcal{Q}_{s, \alpha},\]</p><p>where <span>$\mathcal{N} = \sum_\alpha \mathcal{A}_\alpha \delta \left(\boldsymbol{k} - \boldsymbol{k}_\alpha\right)$</span> and <span>$\mathcal{S}_s = \sum_\alpha \mathcal{Q}_{s, \alpha} \delta \left(\boldsymbol{k} - \boldsymbol{k}_\alpha\right)$</span>. Similarly, the eikonal equations become</p><p class="math-container">\[\begin{align*}
    \frac{c_{\mathrm{g} z, \alpha}}{J} \frac{\partial \omega_\alpha}{\partial \widehat{z}} &amp; = 0,\\
    \frac{c_{\mathrm{g} z, \alpha}}{J} \frac{\partial m_\alpha}{\partial \widehat{z}} &amp; = J^{- 1} \frac{\partial \Omega}{\partial \widehat{z}}.
\end{align*}\]</p><p>Thus, the intrinsic frequency and vertical wavenumber can be determined from</p><p class="math-container">\[\begin{align*}
    \widehat{\omega}_\alpha &amp; = \omega_\alpha - \boldsymbol{k}_\alpha \cdot \boldsymbol{u}_\mathrm{b},\\
    m_\alpha &amp; = - \mathrm{sgn} \left(\widehat{\omega}_\alpha\right) \sqrt{\frac{\left(k_\alpha^2 + l_\alpha^2\right) \left(N^2 - \widehat{\omega}_\alpha^2\right)}{\widehat{\omega}_\alpha^2 - f^2}},
\end{align*}\]</p><p>where <span>$\omega_\alpha$</span> is a constant. Since the wave-action-density equation is solved by vertical integration, the saturation scheme must be amended. Specifically, the saturation sink term <span>$\mathcal{Q}_{\mathrm{s}, \alpha}$</span> is integrated over a pseudo-time step <span>$J \Delta \widehat{z} / c_{\mathrm{g} z, \alpha}$</span>. Therein, the turbulent viscosity and diffusivity is given by</p><p class="math-container">\[K = \frac{\overline{\rho}}{4} \left[\sum\limits_\alpha \frac{J \Delta \widehat{z}}{c_{\mathrm{g} z, \alpha}} N^4 \left(k_\alpha^2 + l_\alpha^2\right) m_\alpha^2 \frac{\mathcal{A}_\alpha}{\widehat{\omega}_\alpha}\right]^{- 1} \max \left[0, \frac{2}{\overline{\rho}} \sum\limits_\alpha \frac{N^4 \left(k_\alpha^2 + l_\alpha^2\right) m_\alpha^2}{\widehat{\omega}_\alpha \left|\boldsymbol{k}_\alpha\right|^2} \mathcal{A}_\alpha - \alpha_\mathrm{s}^2 N^4\right]\]</p><p>(see <a href="https://doi.org/10.1175/JAS-D-20-0065.1">Boeloeni et al., 2021</a>; <a href="https://doi.org/10.1175/JAS-D-24-0158.1">Jochum et al., 2025</a>).</p><h3 id="Orographic-source"><a class="docs-heading-anchor" href="#Orographic-source">Orographic source</a><a id="Orographic-source-1"></a><a class="docs-heading-anchor-permalink" href="#Orographic-source" title="Permalink"></a></h3><p>The orographic source is a lower-boundary condition for the wave-property fields. Its formulation uses the decomposition</p><p class="math-container">\[h \left(x, y\right) = h_\mathrm{b} + \sum\limits_\alpha \Re \left\{h_{\mathrm{w}, \alpha} \exp \left[i \varphi_\alpha \left(x, y\right)\right]\right\}\]</p><p>of the surface topography <span>$h$</span>, where <span>$h_\mathrm{b}$</span> and <span>$h_\mathrm{w}$</span> vary slowly in <span>$x$</span> and <span>$y$</span>, as opposed to the quickly varying orographic phase <span>$\varphi_\alpha$</span>. By inserting this and the WKB ansatz for the wind into the no-normal-flow condition</p><p class="math-container">\[0 = \boldsymbol{u} \cdot \boldsymbol{n} = - u \frac{\partial h}{\partial x} - v \frac{\partial h}{\partial y} + w \qquad \mathrm{at} \quad z = h,\]</p><p>one obtains</p><p class="math-container">\[\mathcal{N} = \frac{\overline{\rho}}{2} \sum\limits_\alpha \frac{\widehat{\omega}_\alpha \left|\boldsymbol{k}_\alpha\right|^2}{k_\alpha^2 + l_\alpha^2} \left|h_{\mathrm{w}, \alpha}\right|^2 \delta \left(\boldsymbol{k} - \boldsymbol{k}_\alpha\right) \qquad \mathrm{at} \quad z = h_\mathrm{b}.\]</p><p>The vertical wavenumber at the source is</p><p class="math-container">\[m_\alpha = - \mathrm{sgn} \left(\widehat{\omega}_\alpha\right) \sqrt{\frac{\left(k_\alpha^2 + l_\alpha^2\right) \left(N^2 - \widehat{\omega}_\alpha^2\right)}{\widehat{\omega}_\alpha^2 - f^2}}\]</p><p>(see <a href="https://doi.org/10.1175/JAS-D-24-0158.1">Jochum et al., 2025</a>).</p><h3 id="Tracer-fluxes"><a class="docs-heading-anchor" href="#Tracer-fluxes">Tracer fluxes</a><a id="Tracer-fluxes-1"></a><a class="docs-heading-anchor-permalink" href="#Tracer-fluxes" title="Permalink"></a></h3><p>The leading-order tracer fluxes due to unresolved gravity waves are given by</p><p class="math-container">\[\begin{align*}
    \overline{\rho} \left\langle \chi&#39; \boldsymbol{u}&#39; \right\rangle &amp; = f \int \frac{m}{\widehat{\omega} \left|\boldsymbol{k}\right|^2} \boldsymbol{k} \times \begin{pmatrix}
        \partial_{\widehat{x}} \chi_\mathrm{b} + G^{13} \partial_{\widehat{z}} \chi_\mathrm{b}\\
        \partial_{\widehat{y}} \chi_\mathrm{b} + G^{23} \partial_{\widehat{z}} \chi_\mathrm{b}\\
        J^{- 1} \partial_{\widehat{z}} \chi_\mathrm{b}
    \end{pmatrix} \mathcal{N} \, \mathrm{d} V_{\boldsymbol{k}}
\end{align*}\]</p><p>and the corresponding impact on the large-scale tracer is</p><p class="math-container">\[\begin{align*}
    \left(\frac{\partial \rho_\mathrm{b} \chi_\mathrm{b}}{\partial t}\right)_\mathrm{w} = - \frac{\rho_\mathrm{b}}{\overline{\rho}} \begin{pmatrix}
        \partial_{\widehat{x}} + G^{13} \partial_{\widehat{z}}\\
        \partial_{\widehat{y}} + G^{23} \partial_{\widehat{z}}\\
        J^{- 1} \partial_{\widehat{z}}
    \end{pmatrix} \cdot \left(\overline{\rho} \left\langle \chi&#39; \boldsymbol{u}&#39; \right\rangle\right).
\end{align*}\]</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../../examples/wkb_mountain_wave_simulation/">« WKB mountain-wave simulation</a><a class="docs-footer-nextpage" href="../numerics/">Numerics »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.15.0 on <span class="colophon-date" title="Saturday 1 November 2025 20:22">Saturday 1 November 2025</span>. Using Julia version 1.10.10.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
