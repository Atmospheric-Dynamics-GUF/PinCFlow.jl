<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>FluxCalculator · PinCFlow.jl</title><meta name="title" content="FluxCalculator · PinCFlow.jl"/><meta property="og:title" content="FluxCalculator · PinCFlow.jl"/><meta property="twitter:title" content="FluxCalculator · PinCFlow.jl"/><meta name="description" content="Documentation for PinCFlow.jl."/><meta property="og:description" content="Documentation for PinCFlow.jl."/><meta property="twitter:description" content="Documentation for PinCFlow.jl."/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">PinCFlow.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../../examples/mountain_wave_simulation/">Mountain-wave simulation</a></li><li><a class="tocitem" href="../../examples/wkb_mountain_wave_simulation/">WKB mountain-wave simulation</a></li></ul></li><li><span class="tocitem">Theory</span><ul><li><a class="tocitem" href="../../theory/physics/">Physics</a></li><li><a class="tocitem" href="../../theory/numerics/">Numerics</a></li></ul></li><li><span class="tocitem">Reference</span><ul><li><a class="tocitem" href="../pincflow/">PinCFlow</a></li><li><a class="tocitem" href="../types/">Types</a></li><li><a class="tocitem" href="../mpi_operations/">MPIOperations</a></li><li><a class="tocitem" href="../boundaries/">Boundaries</a></li><li class="is-active"><a class="tocitem" href>FluxCalculator</a></li><li><a class="tocitem" href="../poisson_solver/">PoissonSolver</a></li><li><a class="tocitem" href="../update/">Update</a></li><li><a class="tocitem" href="../msgwam/">MSGWaM</a></li><li><a class="tocitem" href="../integration/">Integration</a></li><li><a class="tocitem" href="../output/">Output</a></li></ul></li><li><a class="tocitem" href="../../developer_guide/">Developer guide</a></li><li><a class="tocitem" href="../../changelog/">Changelog</a></li><li><a class="tocitem" href="../../authors/">Authors</a></li><li><a class="tocitem" href="../../contributing/">Contributing</a></li><li><a class="tocitem" href="../../code_of_conduct/">Code of Conduct</a></li><li><a class="tocitem" href="../../license/">License</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Reference</a></li><li class="is-active"><a href>FluxCalculator</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>FluxCalculator</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/Atmospheric-Dynamics-GUF/PinCFlow.jl.git" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="FluxCalculator"><a class="docs-heading-anchor" href="#FluxCalculator">FluxCalculator</a><a id="FluxCalculator-1"></a><a class="docs-heading-anchor-permalink" href="#FluxCalculator" title="Permalink"></a></h1><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="PinCFlow.FluxCalculator" href="#PinCFlow.FluxCalculator"><code>PinCFlow.FluxCalculator</code></a> — <span class="docstring-category">Module</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">FluxCalculator</code></pre><p>Module for flux calculation.</p><p>Provides functions for MUSCL reconstruction and flux computation.</p><p><strong>See also</strong></p><ul><li><p><a href="../types/#PinCFlow.Types"><code>PinCFlow.Types</code></a></p></li><li><p><a href="../boundaries/#PinCFlow.Boundaries"><code>PinCFlow.Boundaries</code></a></p></li><li><p><a href="../update/#PinCFlow.Update"><code>PinCFlow.Update</code></a></p></li></ul></div></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="PinCFlow.FluxCalculator.apply_1d_muscl!" href="#PinCFlow.FluxCalculator.apply_1d_muscl!"><code>PinCFlow.FluxCalculator.apply_1d_muscl!</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">apply_1d_muscl!(
    phi::AbstractVector{&lt;:AbstractFloat},
    phitilde::AbstractMatrix{&lt;:AbstractFloat},
    phisize::Integer,
    limiter_type::MCVariant,
)</code></pre><p>Apply the Monotonic Upstream-centered Scheme for Conservation Laws (MUSCL) for reconstruction in one dimension.</p><p>The reconstruction to the left is given by</p><p class="math-container">\[{\widetilde{\phi}}^\mathrm{L} = \begin{cases}
    \phi &amp; \mathrm{if} \quad \phi = \phi_{i - 1} \quad \mathrm{or} \quad \phi = \phi_{i + 1},\\
    \phi - \frac{1}{2} \eta \left(\frac{\phi_{i + 1} - \phi}{\phi - \phi_{i - 1}}\right) \left(\phi - \phi_{i - 1}\right) &amp; \mathrm{else}
\end{cases}\]</p><p>and that to the right is given by</p><p class="math-container">\[{\widetilde{\phi}}^\mathrm{R} = \begin{cases}
    \phi &amp; \mathrm{if} \quad \phi = \phi_{i - 1} \quad \mathrm{or} \quad \phi = \phi_{i + 1},\\
    \phi + \frac{1}{2} \eta \left(\frac{\phi - \phi_{i - 1}}{\phi_{i + 1} - \phi}\right) \left(\phi_{i + 1} - \phi\right) &amp; \mathrm{else},
\end{cases}\]</p><p>where</p><p class="math-container">\[\eta \left(\xi\right) = \max \left[0, \min \left(2 \xi, \frac{2 + \xi}{3}, 2\right)\right]\]</p><p>is the monotonized-centered variant limiter.</p><p><strong>Arguments</strong></p><ul><li><p><code>phi</code>: Input vector.</p></li><li><p><code>phitilde</code>: Output matrix with reconstructed values. The two columns of <code>phitilde</code> contain the reconstructions to the left and right. No reconstruction is computed for the first and last row of <code>phitilde</code>.</p></li><li><p><code>phisize</code>: Length of the input vector <code>phi</code>.</p></li><li><p><code>limiter_type</code>: Type of flux limiter to use.</p></li></ul></div></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="PinCFlow.FluxCalculator.apply_3d_muscl!" href="#PinCFlow.FluxCalculator.apply_3d_muscl!"><code>PinCFlow.FluxCalculator.apply_3d_muscl!</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">apply_3d_muscl!(
    phi::AbstractArray{&lt;:AbstractFloat, 3},
    phitilde::AbstractArray{&lt;:AbstractFloat, 5},
    nxx::Integer,
    nyy::Integer,
    nzz::Integer,
    limiter_type::AbstractLimiter,
)</code></pre><p>Apply the Monotonic Upstream-centered Scheme for Conservation Laws (MUSCL) for reconstruction in three dimensions.</p><p><strong>Arguments</strong></p><ul><li><p><code>phi</code>: Input array.</p></li><li><p><code>phitilde</code>: Output array with reconstructed values. The fourth dimension represents the directions in which the input was reconstructed and the fifth dimension the reconstructions to the left and right.</p></li><li><p><code>nxx</code>: Size of <code>phi</code> in <span>$\widehat{x}$</span>-direction.</p></li><li><p><code>nyy</code>: Size of <code>phi</code> in <span>$\widehat{y}$</span>-direction.</p></li><li><p><code>nzz</code>: Size of <code>phi</code> in <span>$\widehat{z}$</span>-direction.</p></li><li><p><code>limiter_type</code>: Type of flux limiter to use.</p></li></ul><p><strong>See also</strong></p><ul><li><a href="#PinCFlow.FluxCalculator.apply_1d_muscl!"><code>PinCFlow.FluxCalculator.apply_1d_muscl!</code></a></li></ul></div></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="PinCFlow.FluxCalculator.compute_flux" href="#PinCFlow.FluxCalculator.compute_flux"><code>PinCFlow.FluxCalculator.compute_flux</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">compute_flux(
    usurf::AbstractFloat,
    phiup::AbstractFloat,
    phidown::AbstractFloat,
)::AbstractFloat</code></pre><p>Compute and return the upstream flux from reconstructed values, based on the sign of the transporting velocity.</p><p><strong>Arguments</strong></p><ul><li><p><code>usurf</code>: Transporting velocity.</p></li><li><p><code>phiup</code>: Upstream reconstruction for <code>usurf &gt; 0</code>.</p></li><li><p><code>phidown</code>: Downstream reconstruction for <code>usurf &gt; 0</code>.</p></li></ul></div></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="PinCFlow.FluxCalculator.compute_fluxes!" href="#PinCFlow.FluxCalculator.compute_fluxes!"><code>PinCFlow.FluxCalculator.compute_fluxes!</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">compute_fluxes!(state::State, predictands::Predictands)</code></pre><p>Compute fluxes by dispatching to specialized methods for each prognostic variable.</p><pre><code class="language-julia hljs">compute_fluxes!(state::State, predictands::Predictands, variable::Rho)</code></pre><p>Compute the density fluxes in all three directions, by dispatching to a model-specific method.</p><pre><code class="language-julia hljs">compute_fluxes!(
    state::State,
    predictands::Predictands,
    variable::Rho,
    model::Boussinesq,
)</code></pre><p>Return in Boussinesq mode.</p><pre><code class="language-julia hljs">compute_fluxes!(
    state::State,
    predictands::Predictands,
    variable::Rho,
    model::Union{PseudoIncompressible, Compressible},
)</code></pre><p>Compute the density fluxes in all three directions.</p><p>The fluxes are given by</p><p class="math-container">\[\begin{align*}
    \mathcal{F}^{\rho, \widehat{x}}_{i + 1 / 2} &amp; = \frac{\tau_{\widehat{x}}}{2} \left\{\left[1 + \mathrm{sgn} \left(\tau_{\widehat{x}}\right)\right] {\widetilde{\phi}}^\mathrm{R} + \left[1 - \mathrm{sgn} \left(\tau_{\widehat{x}}\right)\right] {\widetilde{\phi}}_{i + 1}^\mathrm{L}\right\},\\
    \mathcal{F}^{\rho, \widehat{y}}_{j + 1 / 2} &amp; = \frac{\tau_{\widehat{y}}}{2} \left\{\left[1 + \mathrm{sgn} \left(\tau_{\widehat{y}}\right)\right] {\widetilde{\phi}}^\mathrm{F} + \left[1 - \mathrm{sgn} \left(\tau_{\widehat{y}}\right)\right] {\widetilde{\phi}}_{j + 1}^\mathrm{B}\right\},\\
    \mathcal{F}^{\rho, \widehat{z}}_{k + 1 / 2} &amp; = \frac{\tau_{\widehat{z}}}{2} \left\{\left[1 + \mathrm{sgn} \left(\tau_{\widehat{z}}\right)\right] {\widetilde{\phi}}^\mathrm{U} + \left[1 - \mathrm{sgn} \left(\tau_{\widehat{z}}\right)\right] {\widetilde{\phi}}_{k + 1}^\mathrm{D}\right\},
\end{align*}\]</p><p>where</p><p class="math-container">\[\begin{align*}
    \tau_{\widehat{x}} &amp; = \left(J P_\mathrm{old}\right)_{i + 1 / 2} u_{\mathrm{old}, i + 1 / 2},\\
    \tau_{\widehat{y}} &amp; = \left(J P_\mathrm{old}\right)_{j + 1 / 2} v_{\mathrm{old}, j + 1 / 2},\\
    \tau_{\widehat{z}} &amp; = \left(J P_\mathrm{old}\right)_{k + 1 / 2} \widehat{w}_{\mathrm{old}, k + 1 / 2}
\end{align*}\]</p><p>are the transporting velocities (weighted by the Jacobian) and <span>$\widetilde{\phi}$</span> is the reconstruction of <span>$\rho / P_\mathrm{old}$</span>. More specifically, the superscripts <span>$\mathrm{R}$</span>, <span>$\mathrm{L}$</span>, <span>$\mathrm{F}$</span>, <span>$\mathrm{B}$</span>, <span>$\mathrm{U}$</span> and <span>$\mathrm{D}$</span> indicate reconstructions at the right, left, forward, backward, upward and downward cell interfaces of the respective grid points, respectively. Quantities with the subscript <span>$\mathrm{old}$</span> are obtained from a previous state, which is partially passed to the method via <code>predictands</code>.</p><pre><code class="language-julia hljs">compute_fluxes!(state::State, predictands::Predictands, variable::RhoP)</code></pre><p>Compute the density-fluctuations fluxes in all three directions.</p><p>The computation is analogous to that of the density fluxes.</p><pre><code class="language-julia hljs">compute_fluxes!(
    state::State,
    predictands::Predictands,
    model::Union{Boussinesq, PseudoIncompressible},
    variable::P,
)</code></pre><p>Return in non-compressible modes.</p><pre><code class="language-julia hljs">compute_fluxes!(
    state::State,
    predictands::Predictands,
    model::Compressible,
    variable::P,
)</code></pre><p>Compute the mass-weighted potential-temperature fluxes in all three directions.</p><p>The fluxes are given by</p><p class="math-container">\[\begin{align*}
    \mathcal{F}^{P, \widehat{x}}_{i + 1 / 2} &amp; = \left(J P_\mathrm{old}\right)_{i + 1 / 2} u_{\mathrm{old}, i + 1 / 2},\\
    \mathcal{F}^{P, \widehat{y}}_{j + 1 / 2} &amp; = \left(J P_\mathrm{old}\right)_{j + 1 / 2} v_{\mathrm{old}, j + 1 / 2},\\
    \mathcal{F}^{P, \widehat{z}}_{k + 1 / 2} &amp; = \left(J P_\mathrm{old}\right)_{k + 1 / 2} \widehat{w}_{\mathrm{old}, k + 1 / 2}.
\end{align*}\]</p><pre><code class="language-julia hljs">compute_fluxes!(state::State, old_predictands::Predictands, variable::U)</code></pre><p>Compute the zonal-momentum fluxes in all three directions.</p><p>The fluxes are first set to the advective parts</p><p class="math-container">\[\begin{align*}
    \mathcal{F}^{\rho u, \widehat{x}}_{i + 1} &amp; = \frac{\tau_{\widehat{x}}}{2} \left\{\left[1 + \mathrm{sgn} \left(\tau_{\widehat{x}}\right)\right] {\widetilde{\phi}}_{i + 1 / 2}^\mathrm{R} + \left[1 - \mathrm{sgn} \left(\tau_{\widehat{x}}\right)\right] {\widetilde{\phi}}_{i + 3 / 2}^\mathrm{L}\right\},\\
    \mathcal{F}^{\rho u, \widehat{y}}_{i + 1 / 2, j + 1 / 2} &amp; = \frac{\tau_{\widehat{y}}}{2} \left\{\left[1 + \mathrm{sgn} \left(\tau_{\widehat{y}}\right)\right] {\widetilde{\phi}}_{i + 1 / 2}^\mathrm{F} + \left[1 - \mathrm{sgn} \left(\tau_{\widehat{y}}\right)\right] {\widetilde{\phi}}_{i + 1 / 2, j + 1}^\mathrm{B}\right\},\\
    \mathcal{F}^{\rho u, \widehat{z}}_{i + 1 / 2, k + 1 / 2} &amp; = \frac{\tau_{\widehat{z}}}{2} \left\{\left[1 + \mathrm{sgn} \left(\tau_{\widehat{z}}\right)\right] {\widetilde{\phi}}_{i + 1 / 2}^\mathrm{U} + \left[1 - \mathrm{sgn} \left(\tau_{\widehat{z}}\right)\right] {\widetilde{\phi}}_{i + 1 / 2, k + 1}^\mathrm{D}\right\},
\end{align*}\]</p><p>with</p><p class="math-container">\[\begin{align*}
    \tau_{\widehat{x}} &amp; = \left[\left(J P_\mathrm{old}\right)_{i + 1 / 2} u_{\mathrm{old}, i + 1 / 2}\right]_{i + 1},\\
    \tau_{\widehat{y}} &amp; = \left[\left(J P_\mathrm{old}\right)_{j + 1 / 2} v_{\mathrm{old}, j + 1 / 2}\right]_{i + 1 / 2, j + 1 / 2},\\
    \tau_{\widehat{z}} &amp; = \left[\left(J P_\mathrm{old}\right)_{k + 1 / 2} \widehat{w}_{\mathrm{old}, k + 1 / 2}\right]_{i + 1 / 2, k + 1 / 2}
\end{align*}\]</p><p>and <span>$\widetilde{\phi}$</span> being the reconstruction of <span>$\rho_{i + 1 / 2} u_{i + 1 / 2} / P_{\mathrm{old}, i + 1 / 2}$</span>. If the viscosity is nonzero, the viscous parts (weighted by the Jacobian) are then added, i.e.</p><p class="math-container">\[\begin{align*}
    \mathcal{F}^{\rho u, \widehat{x}}_{i + 1} &amp; \rightarrow \mathcal{F}^{\rho u, \widehat{x}}_{i + 1} - \eta_{i + 1} \left(J \widehat{\Pi}^{11}\right)_{i + 1},\\
    \mathcal{F}^{\rho u, \widehat{y}}_{i + 1 / 2, j + 1 / 2} &amp; \rightarrow \mathcal{F}^{\rho u, \widehat{y}}_{i + 1 / 2, j + 1 / 2} - \eta_{i + 1 / 2, j + 1 / 2} \left(J \widehat{\Pi}^{12}\right)_{i + 1 / 2, j + 1 / 2},\\
    \mathcal{F}^{\rho u, \widehat{z}}_{i + 1 / 2, k + 1 / 2} &amp; \rightarrow \mathcal{F}^{\rho u, \widehat{z}}_{i + 1 / 2, k + 1 / 2} - \eta_{i + 1 / 2, k + 1 / 2} \left(J \widehat{\Pi}^{13}\right)_{i + 1 / 2, k + 1 / 2}.
\end{align*}\]</p><p>Finally, if the diffusivity <span>$\mu$</span> is nonzero, the diffusive parts (weighted by the Jacobian) are added, i.e.</p><p class="math-container">\[\begin{align*}
    \mathcal{F}^{\rho u, \widehat{x}}_{i + 1} &amp; \rightarrow \mathcal{F}^{\rho u, \widehat{x}}_{i + 1} - \mu_{i + 1} \left[J \widehat{\left(\boldsymbol{\nabla} u\right)}^{\widehat{x}}\right]_{i + 1},\\
    \mathcal{F}^{\rho u, \widehat{y}}_{i + 1 / 2, j + 1 / 2} &amp; \rightarrow \mathcal{F}^{\rho u, \widehat{y}}_{i + 1 / 2, j + 1 / 2} - \mu_{i + 1 / 2, j + 1 / 2} \left[J \widehat{\left(\boldsymbol{\nabla} u\right)}^{\widehat{y}}\right]_{i + 1 / 2, j + 1 / 2},\\
    \mathcal{F}^{\rho u, \widehat{z}}_{i + 1 / 2, k + 1 / 2} &amp; \rightarrow \mathcal{F}^{\rho u, \widehat{z}}_{i + 1 / 2, k + 1 / 2} - \mu_{i + 1 / 2, k + 1 / 2} \left[J \widehat{\left(\boldsymbol{\nabla} u\right)}^{\widehat{z}}\right]_{i + 1 / 2, k + 1 / 2}.
\end{align*}\]</p><pre><code class="language-julia hljs">compute_fluxes!(state::State, old_predictands::Predictands, variable::V)</code></pre><p>Compute the meridional-momentum fluxes in all three directions.</p><p>The fluxes are first set to the advective parts</p><p class="math-container">\[\begin{align*}
    \mathcal{F}^{\rho v, \widehat{x}}_{i + 1 / 2, j + 1 / 2} &amp; = \frac{\tau_{\widehat{x}}}{2} \left\{\left[1 + \mathrm{sgn} \left(\tau_{\widehat{x}}\right)\right] {\widetilde{\phi}}_{j + 1 / 2}^\mathrm{R} + \left[1 - \mathrm{sgn} \left(\tau_{\widehat{x}}\right)\right] {\widetilde{\phi}}_{i + 1, j + 1 / 2}^\mathrm{L}\right\},\\
    \mathcal{F}^{\rho v, \widehat{y}}_{j + 1} &amp; = \frac{\tau_{\widehat{y}}}{2} \left\{\left[1 + \mathrm{sgn} \left(\tau_{\widehat{y}}\right)\right] {\widetilde{\phi}}_{j + 1 / 2}^\mathrm{F} + \left[1 - \mathrm{sgn} \left(\tau_{\widehat{y}}\right)\right] {\widetilde{\phi}}_{j + 3 / 2}^\mathrm{B}\right\},\\
    \mathcal{F}^{\rho v, \widehat{z}}_{j + 1 / 2, k + 1 / 2} &amp; = \frac{\tau_{\widehat{z}}}{2} \left\{\left[1 + \mathrm{sgn} \left(\tau_{\widehat{z}}\right)\right] {\widetilde{\phi}}_{j + 1 / 2}^\mathrm{U} + \left[1 - \mathrm{sgn} \left(\tau_{\widehat{z}}\right)\right] {\widetilde{\phi}}_{j + 1 / 2, k + 1}^\mathrm{D}\right\},
\end{align*}\]</p><p>with</p><p class="math-container">\[\begin{align*}
    \tau_{\widehat{x}} &amp; = \left[\left(J P_\mathrm{old}\right)_{i + 1 / 2} u_{\mathrm{old}, i + 1 / 2}\right]_{i + 1 / 2, j + 1 / 2},\\
    \tau_{\widehat{y}} &amp; = \left[\left(J P_\mathrm{old}\right)_{j + 1 / 2} v_{\mathrm{old}, j + 1 / 2}\right]_{j + 1},\\
    \tau_{\widehat{z}} &amp; = \left[\left(J P_\mathrm{old}\right)_{k + 1 / 2} \widehat{w}_{\mathrm{old}, k + 1 / 2}\right]_{j + 1 / 2, k + 1 / 2}
\end{align*}\]</p><p>and <span>$\widetilde{\phi}$</span> being the reconstruction of <span>$\rho_{j + 1 / 2} v_{j + 1 / 2} / P_{\mathrm{old}, j + 1 / 2}$</span>. If the viscosity is nonzero, the viscous parts (weighted by the Jacobian) are then added, i.e.</p><p class="math-container">\[\begin{align*}
    \mathcal{F}^{\rho v, \widehat{x}}_{i + 1 / 2, j + 1 / 2} &amp; \rightarrow \mathcal{F}^{\rho v, \widehat{x}}_{i + 1 / 2, j + 1 / 2} - \eta_{i + 1 / 2, j + 1 / 2} \left(J \widehat{\Pi}^{12}\right)_{i + 1 / 2, j + 1 / 2},\\
    \mathcal{F}^{\rho v, \widehat{y}}_{j + 1} &amp; \rightarrow \mathcal{F}^{\rho v, \widehat{y}}_{j + 1} - \eta_{j + 1} \left(J \widehat{\Pi}^{22}\right)_{j + 1},\\
    \mathcal{F}^{\rho v, \widehat{z}}_{j + 1 / 2, k + 1 / 2} &amp; \rightarrow \mathcal{F}^{\rho v, \widehat{z}}_{j + 1 / 2, k + 1 / 2} - \eta_{j + 1 / 2, k + 1 / 2} \left(J \widehat{\Pi}^{23}\right)_{j + 1 / 2, k + 1 / 2}.
\end{align*}\]</p><p>Finally, if the diffusivity <span>$\mu$</span> is nonzero, the diffusive parts (weighted by the Jacobian) are added, i.e.</p><p class="math-container">\[\begin{align*}
    \mathcal{F}^{\rho v, \widehat{x}}_{i + 1 / 2, j + 1 / 2} &amp; \rightarrow \mathcal{F}^{\rho v, \widehat{x}}_{i + 1 / 2, j + 1 / 2} - \mu_{i + 1 / 2, j + 1 / 2} \left[J \widehat{\left(\boldsymbol{\nabla} v\right)}^{\widehat{x}}\right]_{i + 1 / 2, j + 1 / 2},\\
    \mathcal{F}^{\rho v, \widehat{y}}_{j + 1} &amp; \rightarrow \mathcal{F}^{\rho v, \widehat{y}}_{j + 1} - \mu_{j + 1} \left[J \widehat{\left(\boldsymbol{\nabla} v\right)}^{\widehat{y}}\right]_{j + 1},\\
    \mathcal{F}^{\rho v, \widehat{z}}_{j + 1 / 2, k + 1 / 2} &amp; \rightarrow \mathcal{F}^{\rho v, \widehat{z}}_{j + 1 / 2, k + 1 / 2} - \mu_{j + 1 / 2, k + 1 / 2} \left[J \widehat{\left(\boldsymbol{\nabla} v\right)}^{\widehat{z}}\right]_{j + 1 / 2, k + 1 / 2}.
\end{align*}\]</p><pre><code class="language-julia hljs">compute_fluxes!(state::State, old_predictands::Predictands, variable::W)</code></pre><p>Compute the vertical-momentum fluxes in all three directions.</p><p>The fluxes are first set to the advective parts</p><p class="math-container">\[\begin{align*}
    \mathcal{F}^{\rho w, \widehat{x}}_{i + 1 / 2, k + 1 / 2} &amp; = \frac{\tau_{\widehat{x}}}{2} \left\{\left[1 + \mathrm{sgn} \left(\tau_{\widehat{x}}\right)\right] {\widetilde{\phi}}_{k + 1 / 2}^\mathrm{R} + \left[1 - \mathrm{sgn} \left(\tau_{\widehat{x}}\right)\right] {\widetilde{\phi}}_{i + 1, k + 1 / 2}^\mathrm{L}\right\},\\
    \mathcal{F}^{\rho w, \widehat{y}}_{j + 1 / 2, k + 1 / 2} &amp; = \frac{\tau_{\widehat{y}}}{2} \left\{\left[1 + \mathrm{sgn} \left(\tau_{\widehat{y}}\right)\right] {\widetilde{\phi}}_{k + 1 / 2}^\mathrm{F} + \left[1 - \mathrm{sgn} \left(\tau_{\widehat{y}}\right)\right] {\widetilde{\phi}}_{j + 1, k + 1 / 2}^\mathrm{B}\right\},\\
    \mathcal{F}^{\rho w, \widehat{z}}_{k + 1} &amp; = \frac{\tau_{\widehat{z}}}{2} \left\{\left[1 + \mathrm{sgn} \left(\tau_{\widehat{z}}\right)\right] {\widetilde{\phi}}_{k + 1 / 2}^\mathrm{U} + \left[1 - \mathrm{sgn} \left(\tau_{\widehat{z}}\right)\right] {\widetilde{\phi}}_{k + 3 / 2}^\mathrm{D}\right\},
\end{align*}\]</p><p>with</p><p class="math-container">\[\begin{align*}
    \tau_{\widehat{x}} &amp; = \left[\left(J P_\mathrm{old}\right)_{i + 1 / 2} u_{\mathrm{old}, i + 1 / 2}\right]_{i + 1 / 2, k + 1 / 2},\\
    \tau_{\widehat{y}} &amp; = \left[\left(J P_\mathrm{old}\right)_{j + 1 / 2} v_{\mathrm{old}, j + 1 / 2}\right]_{j + 1 / 2, k + 1 / 2},\\
    \tau_{\widehat{z}} &amp; = \left[\left(J P_\mathrm{old}\right)_{k + 1 / 2} \widehat{w}_{\mathrm{old}, k + 1 / 2}\right]_{k + 1}
\end{align*}\]</p><p>and <span>$\widetilde{\phi}$</span> being the reconstruction of <span>$\rho_{k + 1 / 2} w_{k + 1 / 2} / P_{\mathrm{old}, k + 1 / 2}$</span>. If the viscosity is nonzero, the viscous parts (weighted by the Jacobian) are then added, i.e.</p><p class="math-container">\[\begin{align*}
    \mathcal{F}^{\rho w, \widehat{x}}_{i + 1 / 2, k + 1 / 2} &amp; \rightarrow \mathcal{F}^{\rho w, \widehat{x}}_{i + 1 / 2, k + 1 / 2} - \eta_{i + 1 / 2, k + 1 / 2} \left(J \Pi^{13}\right)_{i + 1 / 2, k + 1 / 2},\\
    \mathcal{F}^{\rho w, \widehat{y}}_{j + 1 / 2, k + 1 / 2} &amp; \rightarrow \mathcal{F}^{\rho w, \widehat{y}}_{j + 1 / 2, k + 1 / 2} - \eta_{j + 1 / 2, k + 1 / 2} \left(J \Pi^{23}\right)_{j + 1 / 2, k + 1 / 2},\\
    \mathcal{F}^{\rho w, \widehat{z}}_{k + 1} &amp; \rightarrow \mathcal{F}^{\rho w, \widehat{z}}_{k + 1} - \eta_{k + 1} \left[\left(J G^{13} \Pi^{13}\right)_{k + 1} - \left(J G^{23} \Pi^{23}\right)_{k + 1} - \Pi^{33}_{k + 1}\right].
\end{align*}\]</p><p>Finally, if the diffusivity <span>$\mu$</span> is nonzero, the diffusive parts (weighted by the Jacobian) are added, i.e.</p><p class="math-container">\[\begin{align*}
    \mathcal{F}^{\rho w, \widehat{x}}_{i + 1 / 2, k + 1 / 2} &amp; \rightarrow \mathcal{F}^{\rho w, \widehat{x}}_{i + 1 / 2, k + 1 / 2} - \mu_{i + 1 / 2, k + 1 / 2} \left[J \widehat{\left(\boldsymbol{\nabla} w\right)}^{\widehat{x}}\right]_{i + 1 / 2, k + 1 / 2},\\
    \mathcal{F}^{\rho w, \widehat{y}}_{j + 1 / 2, k + 1 / 2} &amp; \rightarrow \mathcal{F}^{\rho w, \widehat{y}}_{j + 1 / 2, k + 1 / 2} - \mu_{j + 1 / 2, k + 1 / 2} \left[J \widehat{\left(\boldsymbol{\nabla} w\right)}^{\widehat{y}}\right]_{j + 1 / 2, k + 1 / 2},\\
    \mathcal{F}^{\rho w, \widehat{z}}_{k + 1} &amp; \rightarrow \mathcal{F}^{\rho w, \widehat{z}}_{k + 1} - \mu_{k + 1} \left[J \widehat{\left(\boldsymbol{\nabla} w\right)}^{\widehat{z}}\right]_{k + 1}.
\end{align*}\]</p><pre><code class="language-julia hljs">compute_fluxes!(state::State, predictands::Predictands, tracer_setup::NoTracer)</code></pre><p>Return for configurations without tracer transport.</p><pre><code class="language-julia hljs">compute_fluxes!(state::State, predictands::Predictands, tracer_setup::TracerOn)</code></pre><p>Compute the tracer fluxes in all three directions.</p><p>The computation is analogous to that of the density fluxes.</p><pre><code class="language-julia hljs">compute_fluxes!(state::State, predictands::Predictands, variable::Theta)</code></pre><p>Compute the potential temperature fluxes due to heat conduction (weighted by the Jacobian).</p><p>The fluxes are given by</p><p class="math-container">\[\begin{align*}
    \mathcal{F}^{\theta, \widehat{x}}_{i + 1 / 2} &amp; = - \lambda_{i + 1 / 2} \left\{\frac{J_{i + 1 / 2}}{\Delta \widehat{x}} \left[\left(\frac{P}{\rho}\right)_{i + 1} - \frac{P}{\rho}\right]\right.\\
    &amp; \qquad \qquad \qquad + \left.\frac{\left(J G^{13}\right)_{i + 1 / 2}}{2 \Delta \widehat{z}} \left[\left(\frac{P}{\rho}\right)_{i + 1 / 2, k + 1} - \left(\frac{P}{\rho}\right)_{i + 1 / 2, k - 1}\right]\right\},\\
    \mathcal{F}^{\theta, \widehat{y}}_{j + 1 / 2} &amp; = - \lambda_{j + 1 / 2} \left\{\frac{J_{j + 1 / 2}}{\Delta \widehat{y}} \left[\left(\frac{P}{\rho}\right)_{j + 1} - \frac{P}{\rho}\right]\right.\\
    &amp; \qquad \qquad \qquad + \left.\frac{\left(J G^{23}\right)_{j + 1 / 2}}{2 \Delta \widehat{z}} \left[\left(\frac{P}{\rho}\right)_{j + 1 / 2, k + 1} - \left(\frac{P}{\rho}\right)_{j + 1 / 2, k - 1}\right]\right\},\\
    \mathcal{F}^{\theta, \widehat{z}}_{k + 1 / 2} &amp; = - \lambda_{k + 1 / 2} \left\{\frac{\left(J G^{13}\right)_{k + 1 / 2}}{2 \Delta \widehat{x}} \left[\left(\frac{P}{\rho}\right)_{i + 1, k + 1 / 2} - \left(\frac{P}{\rho}\right)_{i - 1, k + 1 / 2}\right]\right.\\
    &amp; \qquad \qquad \qquad + \frac{\left(J G^{23}\right)_{k + 1 / 2}}{2 \Delta \widehat{y}} \left[\left(\frac{P}{\rho}\right)_{j + 1, k + 1 / 2} - \left(\frac{P}{\rho}\right)_{j - 1, k + 1 / 2}\right]\\
    &amp; \qquad \qquad \qquad + \left.\frac{\left(J G^{33}\right)_{k + 1 / 2}}{\Delta \widehat{z}} \left[\left(\frac{P}{\rho}\right)_{k + 1} - \frac{P}{\rho}\right]\right\},
\end{align*}\]</p><p>where <span>$\lambda$</span> is the thermal conductivity (computed from <code>state.namelists.atmosphere.thermal_conductivity</code>).</p><p><strong>Arguments</strong></p><ul><li><p><code>state</code>: Model state.</p></li><li><p><code>predictands</code>/<code>old_predictands</code>: The predictands that are used to compute the transporting velocities.</p></li><li><p><code>model</code>: Dynamic equations.</p></li><li><p><code>variable</code>: Flux variable.</p></li><li><p><code>tracer_setup</code>: General tracer-transport configuration.</p></li></ul><p><strong>See also</strong></p><ul><li><p><a href="#PinCFlow.FluxCalculator.compute_flux"><code>PinCFlow.FluxCalculator.compute_flux</code></a></p></li><li><p><a href="../update/#PinCFlow.Update.compute_stress_tensor"><code>PinCFlow.Update.compute_stress_tensor</code></a></p></li><li><p><a href="../update/#PinCFlow.Update.conductive_heating"><code>PinCFlow.Update.conductive_heating</code></a></p></li></ul></div></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="PinCFlow.FluxCalculator.reconstruct!" href="#PinCFlow.FluxCalculator.reconstruct!"><code>PinCFlow.FluxCalculator.reconstruct!</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">reconstruct!(state::State)</code></pre><p>Reconstruct the prognostic variables at the cell interfaces of their respective grids, using the Monotonic Upstream-centered Scheme for Conservation Laws (MUSCL).</p><p>This method calls specialized methods for each prognostic variable.</p><pre><code class="language-julia hljs">reconstruct!(state::State, variable::Rho)</code></pre><p>Reconstruct the density by dispatching to a model-specific method.</p><pre><code class="language-julia hljs">reconstruct!(state::State, variable::Rho, model::Boussinesq)</code></pre><p>Return in Boussinesq mode.</p><pre><code class="language-julia hljs">reconstruct!(
    state::State,
    variable::Rho,
    model::Union{PseudoIncompressible, Compressible},
)</code></pre><p>Reconstruct the density in non-Boussinesq modes.</p><p>Since the transporting velocity is <span>$P \widehat{\boldsymbol{u}}$</span>, the density is divided by <span>$P$</span> before reconstruction.</p><pre><code class="language-julia hljs">reconstruct!(state::State, variable::RhoP)</code></pre><p>Reconstruct the density fluctuations.</p><p>Similar to the density, the density fluctuations are divided by <span>$P$</span> before reconstruction.</p><pre><code class="language-julia hljs">reconstruct!(state::State, variable::U)</code></pre><p>Reconstruct the zonal momentum.</p><p>Since the transporting velocity is <span>$P \widehat{\boldsymbol{u}}$</span>, the zonal momentum is divided by <span>$P$</span> interpolated to the respective cell interfaces before reconstruction.</p><pre><code class="language-julia hljs">reconstruct!(state::State, variable::V)</code></pre><p>Reconstruct the meridional momentum.</p><p>Similar to the zonal momentum, the meridional momentum is divided by <span>$P$</span> interpolated to the respective cell interfaces before reconstruction.</p><pre><code class="language-julia hljs">reconstruct!(state::State, variable::W)</code></pre><p>Reconstruct the vertical momentum.</p><p>The vertical momentum is computed with <code>compute_vertical_wind</code>, <code>set_zonal_boundaries_of_field!</code> and <code>set_meridional_boundaries_of_field!</code>. Similar to the zonal and meridional momenta, the vertical momentum is divided by <span>$P$</span> interpolated to the respective cell interfaces before reconstruction.</p><pre><code class="language-julia hljs">reconstruct!(state::State, tracer_setup::NoTracer)</code></pre><p>Return for configurations without tracer transport.</p><pre><code class="language-julia hljs">reconstruct!(state::State, tracer_setup::TracerOn)</code></pre><p>Reconstruct the tracers.</p><p>Similar to the density, the tracers are divided by <span>$P$</span> before reconstruction.</p><p><strong>Arguments</strong></p><ul><li><p><code>state</code>: Model state.</p></li><li><p><code>variable</code>: The reconstructed variable.</p></li><li><p><code>model</code>: Dynamic equations.</p></li><li><p><code>tracer_setup</code>: General tracer-transport configuration.</p></li></ul><p><strong>See also</strong></p><ul><li><p><a href="#PinCFlow.FluxCalculator.apply_3d_muscl!"><code>PinCFlow.FluxCalculator.apply_3d_muscl!</code></a></p></li><li><p><a href="../update/#PinCFlow.Update.compute_vertical_wind"><code>PinCFlow.Update.compute_vertical_wind</code></a></p></li><li><p><a href="../boundaries/#PinCFlow.Boundaries.set_zonal_boundaries_of_field!"><code>PinCFlow.Boundaries.set_zonal_boundaries_of_field!</code></a></p></li><li><p><a href="../boundaries/#PinCFlow.Boundaries.set_meridional_boundaries_of_field!"><code>PinCFlow.Boundaries.set_meridional_boundaries_of_field!</code></a></p></li></ul></div></section></article></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../boundaries/">« Boundaries</a><a class="docs-footer-nextpage" href="../poisson_solver/">PoissonSolver »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.15.0 on <span class="colophon-date" title="Monday 10 November 2025 09:12">Monday 10 November 2025</span>. Using Julia version 1.10.10.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
