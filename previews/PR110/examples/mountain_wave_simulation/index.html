<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Mountain-wave simulation · PinCFlow.jl</title><meta name="title" content="Mountain-wave simulation · PinCFlow.jl"/><meta property="og:title" content="Mountain-wave simulation · PinCFlow.jl"/><meta property="twitter:title" content="Mountain-wave simulation · PinCFlow.jl"/><meta name="description" content="Documentation for PinCFlow.jl."/><meta property="og:description" content="Documentation for PinCFlow.jl."/><meta property="twitter:description" content="Documentation for PinCFlow.jl."/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">PinCFlow.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Examples</span><ul><li class="is-active"><a class="tocitem" href>Mountain-wave simulation</a><ul class="internal"><li><a class="tocitem" href="#Simulation"><span>Simulation</span></a></li><li><a class="tocitem" href="#Visualization"><span>Visualization</span></a></li></ul></li><li><a class="tocitem" href="../wkb_mountain_wave_simulation/">WKB mountain-wave simulation</a></li></ul></li><li><span class="tocitem">Theory</span><ul><li><a class="tocitem" href="../../theory/physics/">Physics</a></li><li><a class="tocitem" href="../../theory/numerics/">Numerics</a></li></ul></li><li><span class="tocitem">Reference</span><ul><li><a class="tocitem" href="../../reference/pincflow/">PinCFlow</a></li><li><a class="tocitem" href="../../reference/types/">Types</a></li><li><a class="tocitem" href="../../reference/mpi_operations/">MPIOperations</a></li><li><a class="tocitem" href="../../reference/boundaries/">Boundaries</a></li><li><a class="tocitem" href="../../reference/flux_calculator/">FluxCalculator</a></li><li><a class="tocitem" href="../../reference/poisson_solver/">PoissonSolver</a></li><li><a class="tocitem" href="../../reference/update/">Update</a></li><li><a class="tocitem" href="../../reference/msgwam/">MSGWaM</a></li><li><a class="tocitem" href="../../reference/integration/">Integration</a></li><li><a class="tocitem" href="../../reference/output/">Output</a></li></ul></li><li><a class="tocitem" href="../../developer_guide/">Developer guide</a></li><li><a class="tocitem" href="../../changelog/">Changelog</a></li><li><a class="tocitem" href="../../authors/">Authors</a></li><li><a class="tocitem" href="../../contributing/">Contributing</a></li><li><a class="tocitem" href="../../code_of_conduct/">Code of Conduct</a></li><li><a class="tocitem" href="../../license/">License</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Examples</a></li><li class="is-active"><a href>Mountain-wave simulation</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Mountain-wave simulation</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/Atmospheric-Dynamics-GUF/PinCFlow.jl.git" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Mountain-wave-simulation"><a class="docs-heading-anchor" href="#Mountain-wave-simulation">Mountain-wave simulation</a><a id="Mountain-wave-simulation-1"></a><a class="docs-heading-anchor-permalink" href="#Mountain-wave-simulation" title="Permalink"></a></h1><h2 id="Simulation"><a class="docs-heading-anchor" href="#Simulation">Simulation</a><a id="Simulation-1"></a><a class="docs-heading-anchor-permalink" href="#Simulation" title="Permalink"></a></h2><p>The script</p><pre><code class="language-julia hljs"># examples/submit/mountain_wave.jl

using Pkg

Pkg.activate(&quot;examples&quot;)

using Revise
using PinCFlow

npx = length(ARGS) &gt;= 1 ? parse(Int, ARGS[1]) : 1
npy = length(ARGS) &gt;= 2 ? parse(Int, ARGS[2]) : 1
npz = length(ARGS) &gt;= 3 ? parse(Int, ARGS[3]) : 1

atmosphere = AtmosphereNamelist(;
    coriolis_frequency = 0.0E+0,
    initial_u = (x, y, z) -&gt; 1.0E+1,
)
domain = DomainNamelist(;
    x_size = 40,
    y_size = 40,
    z_size = 40,
    lx = 2.0E+4,
    ly = 2.0E+4,
    lz = 2.0E+4,
    npx,
    npy,
    npz,
)
grid = GridNamelist(;
    resolved_topography = (x, y) -&gt; 100 / (1 + (x^2 + y^2) / 1000^2),
)
output =
    OutputNamelist(; output_variables = (:w,), output_file = &quot;mountain_wave.h5&quot;)
sponge = SpongeNamelist(;
    alpharmax = 1.79E-2,
    lateral_sponge = true,
    sponge_type = SinusoidalSponge(),
    relax_to_mean = false,
    relaxation_wind = (1.0E+1, 0.0E+0, 0.0E+0),
)

integrate(Namelists(; atmosphere, domain, grid, output, sponge))
</code></pre><p>performs a 3D mountain-wave simulation in 64 MPI processes (4 for each dimension of physical space) and writes the vertical wind to <code>mountain_wave.h5</code>, if executed with</p><pre><code class="language-shell hljs">mpiexec=$(julia --project=examples -e &#39;using MPICH_jll; println(MPICH_jll.mpiexec_path)&#39;)
${mpiexec} -n 64 julia examples/submit/mountain_wave.jl 4 4 4</code></pre><p>(provided the examples project has been set up as illustrated in the user guide and MPI.jl and HDF5.jl are configured to use their default backends). The surface topography is given by</p><p class="math-container">\[h \left(x, y\right) = \frac{h_0}{1 + \left(x^2 + y^2\right) / l_0^2},\]</p><p>with <span>$h_0 = 100 \, \mathrm{m}$</span> and <span>$l_0 = 1 \, \mathrm{km}$</span>. The atmosphere is isothermal, with the default temperature <span>$T_0 = 300 \, \mathrm{K}$</span> and the initial wind <span>$\boldsymbol{u}_0 = \left(10, 0, 0\right)^\mathrm{T} \, \mathrm{m \, s^{- 1}}$</span>.</p><p>Reflections at the upper boundary are prevented by damping the generated mountain waves in a sponge defined by</p><p class="math-container">\[\alpha_\mathrm{R} \left(x, y, z\right) = \frac{\alpha_{\mathrm{R}, x} \left(x\right) + \alpha_{\mathrm{R}, y} \left(y\right) + \alpha_{\mathrm{R}, z} \left(z\right)}{3}\]</p><p>with</p><p class="math-container">\[\begin{align*}
    \alpha_{\mathrm{R}, x} \left(x\right) &amp; = \begin{cases}
        \alpha_{\mathrm{R}, \max} \sin^2 \left[\frac{\pi \left(x_{\mathrm{R}, 0} - x\right)}{2 \Delta x_\mathrm{R}}\right] &amp; \mathrm{if} \quad x \leq x_{\mathrm{R}, 0},\\
        \alpha_{\mathrm{R}, \max} \sin^2 \left[\frac{\pi \left(x - x_{\mathrm{R}, 1}\right)}{2 \Delta x_\mathrm{R}}\right] &amp; \mathrm{if} \quad x \geq x_{\mathrm{R}, 1},\\
        0 &amp; \mathrm{else},
    \end{cases}\\
    \alpha_{\mathrm{R}, y} \left(y\right) &amp; = \begin{cases}
        \alpha_{\mathrm{R}, \max} \sin^2 \left[\frac{\pi \left(y_{\mathrm{R}, 0} - y\right)}{2 \Delta y_\mathrm{R}}\right] &amp; \mathrm{if} \quad y \leq y_{\mathrm{R}, 0},\\
        \alpha_{\mathrm{R}, \max} \sin^2 \left[\frac{\pi \left(y - y_{\mathrm{R}, 1}\right)}{2 \Delta y_\mathrm{R}}\right] &amp; \mathrm{if} \quad y \geq y_{\mathrm{R}, 1},\\
        0 &amp; \mathrm{else},
    \end{cases}\\
    \alpha_{\mathrm{R}, z} \left(z\right) &amp; = \begin{cases}
        \alpha_{\mathrm{R}, \max} \sin^2 \left[\frac{\pi \left(z - z_\mathrm{R}\right)}{2 \Delta z_\mathrm{R}}\right] &amp; \mathrm{if} \quad z \geq z_\mathrm{R},\\
        0 &amp; \mathrm{else},
    \end{cases}
\end{align*}\]</p><p>where the maximum of the damping coefficient is <span>$\alpha_{\mathrm{R}, \max} = 0.0179 \, \mathrm{s^{- 1}}$</span>, which corresponds to the buoyancy frequency. Since the simulation uses the default setting <code>sponge_extent = 0.5</code>, the parameter <span>$\Delta z_\mathrm{R}$</span> is given by half of the domain&#39;s vertical extent, whereas <span>$\Delta x_\mathrm{R}$</span> and <span>$\Delta y_\mathrm{R}$</span> are each given by a quarter of the domain&#39;s extent in the respective dimension. The edges of the sponge are such that it is horizontally centered at <span>$\left(- 10, - 10\right)^\mathrm{T} \, \mathrm{km}$</span> and has an extent of <span>$\left(\Delta x_\mathrm{R}, \Delta y_\mathrm{R}\right)^\mathrm{T}$</span> below <span>$z_\mathrm{R} = 10 \, \mathrm{km}$</span>, whereas it covers the entire horizontal plane above that altitude (see below for plots of <span>$\alpha_\mathrm{R}$</span> in three cross sections of the domain). This means that the sponge not only prevents wave reflections at the model top but also provides a damping at the horizontal boundaries. Moreover, it is configured such that the wind is relaxed towards its initial state, so that (in the ideal case) the periodicity in <span>$x$</span> and <span>$y$</span> is effectively eliminated by enforcing a constant wind at the domain edges.</p><p><img src="../sinusoidal_sponge.svg" alt/></p><h2 id="Visualization"><a class="docs-heading-anchor" href="#Visualization">Visualization</a><a id="Visualization-1"></a><a class="docs-heading-anchor-permalink" href="#Visualization" title="Permalink"></a></h2><p>The script</p><pre><code class="language-julia hljs"># examples/visualization/mountain_wave.jl

using Pkg

Pkg.activate(&quot;examples&quot;)

using HDF5
using CairoMakie
using Revise
using PinCFlow

h5open(&quot;mountain_wave.h5&quot;) do data
    plot_contours(
        &quot;examples/results/mountain_wave.svg&quot;,
        data,
        &quot;w&quot;,
        (20, 20, 10, 2);
        label = L&quot;w\,[\mathrm{m\,s^{-1}}]&quot;,
    )
    return
end
</code></pre><p>visualizes the vertical wind at the end of the above simulation (i.e. after one hour) in three cross sections of the domain and saves the generated figure to an SVG file that is included below.</p><p><img src="../results/mountain_wave.svg" alt/></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../../">« Home</a><a class="docs-footer-nextpage" href="../wkb_mountain_wave_simulation/">WKB mountain-wave simulation »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.14.1 on <span class="colophon-date" title="Sunday 19 October 2025 15:32">Sunday 19 October 2025</span>. Using Julia version 1.10.10.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
