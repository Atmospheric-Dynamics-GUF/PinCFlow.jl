<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Home · PinCFlow.jl</title><meta name="title" content="Home · PinCFlow.jl"/><meta property="og:title" content="Home · PinCFlow.jl"/><meta property="twitter:title" content="Home · PinCFlow.jl"/><meta name="description" content="Documentation for PinCFlow.jl."/><meta property="og:description" content="Documentation for PinCFlow.jl."/><meta property="twitter:description" content="Documentation for PinCFlow.jl."/><script data-outdated-warner src="assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="assets/documenter.js"></script><script src="search_index.js"></script><script src="siteinfo.js"></script><script src="../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href>PinCFlow.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li class="is-active"><a class="tocitem" href>Home</a><ul class="internal"><li><a class="tocitem" href="#Introduction"><span>Introduction</span></a></li><li><a class="tocitem" href="#User-guide"><span>User guide</span></a></li><li><a class="tocitem" href="#List-of-publications"><span>List of publications</span></a></li></ul></li><li><a class="tocitem" href="examples/">Examples</a></li><li><span class="tocitem">Theory</span><ul><li><a class="tocitem" href="theory/physics/">Physics</a></li><li><a class="tocitem" href="theory/numerics/">Numerics</a></li></ul></li><li><span class="tocitem">Reference</span><ul><li><a class="tocitem" href="reference/pincflow/">PinCFlow</a></li><li><a class="tocitem" href="reference/types/">Types</a></li><li><a class="tocitem" href="reference/mpi_operations/">MPIOperations</a></li><li><a class="tocitem" href="reference/boundaries/">Boundaries</a></li><li><a class="tocitem" href="reference/flux_calculator/">FluxCalculator</a></li><li><a class="tocitem" href="reference/poisson_solver/">PoissonSolver</a></li><li><a class="tocitem" href="reference/update/">Update</a></li><li><a class="tocitem" href="reference/msgwam/">MSGWaM</a></li><li><a class="tocitem" href="reference/integration/">Integration</a></li><li><a class="tocitem" href="reference/output/">Output</a></li></ul></li><li><a class="tocitem" href="developer_guide/">Developer guide</a></li><li><a class="tocitem" href="changelog/">Changelog</a></li><li><a class="tocitem" href="authors/">Authors</a></li><li><a class="tocitem" href="contributing/">Contributing</a></li><li><a class="tocitem" href="code_of_conduct/">Code of Conduct</a></li><li><a class="tocitem" href="license/">License</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Home</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Home</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/Atmospheric-Dynamics-GUF/PinCFlow.jl.git" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="PinCFlow.jl:-An-idealized-atmospheric-flow-solver-coupled-to-the-3D-transient-gravity-wave-model-MS-GWaM"><a class="docs-heading-anchor" href="#PinCFlow.jl:-An-idealized-atmospheric-flow-solver-coupled-to-the-3D-transient-gravity-wave-model-MS-GWaM">PinCFlow.jl: An idealized-atmospheric-flow solver coupled to the 3D transient gravity-wave model MS-GWaM</a><a id="PinCFlow.jl:-An-idealized-atmospheric-flow-solver-coupled-to-the-3D-transient-gravity-wave-model-MS-GWaM-1"></a><a class="docs-heading-anchor-permalink" href="#PinCFlow.jl:-An-idealized-atmospheric-flow-solver-coupled-to-the-3D-transient-gravity-wave-model-MS-GWaM" title="Permalink"></a></h1><p><a href="https://Atmospheric-Dynamics-GUF.github.io/PinCFlow.jl/stable"><img src="https://img.shields.io/badge/docs-stable-blue.svg" alt="Docs-stable"/></a> <a href="https://Atmospheric-Dynamics-GUF.github.io/PinCFlow.jl/dev"><img src="https://img.shields.io/badge/docs-dev-blue.svg" alt="Docs-dev"/></a> <a href="https://github.com/Atmospheric-Dynamics-GUF/PinCFlow.jl/actions?query=workflow%3ACI"><img src="https://github.com/Atmospheric-Dynamics-GUF/PinCFlow.jl/actions/workflows/CI.yml/badge.svg" alt="Build Status"/></a> <a href="https://codecov.io/gh/Atmospheric-Dynamics-GUF/PinCFlow.jl"><img src="https://codecov.io/gh/Atmospheric-Dynamics-GUF/PinCFlow.jl/branch/main/graph/badge.svg" alt="Codecov"/></a> <a href="https://coveralls.io/github/Atmospheric-Dynamics-GUF/PinCFlow.jl?branch=main"><img src="https://coveralls.io/repos/github/Atmospheric-Dynamics-GUF/PinCFlow.jl/badge.svg?branch=main" alt="Coveralls"/></a> <a href="https://opensource.org/licenses/MIT"><img src="https://img.shields.io/badge/License-MIT-success.svg" alt="License: MIT"/></a> <a href="https://doi.org/10.5281/zenodo.17391579"><img src="https://zenodo.org/badge/DOI/10.5281/zenodo.17391579.svg" alt="DOI"/></a></p><h2 id="Introduction"><a class="docs-heading-anchor" href="#Introduction">Introduction</a><a id="Introduction-1"></a><a class="docs-heading-anchor-permalink" href="#Introduction" title="Permalink"></a></h2><p>PinCFlow.jl (<em>P</em>seudo-<em>inC</em>ompressible <em>Flow</em> solver) is an atmospheric-flow solver that was designed for conducting idealized simulations. It integrates the Boussinesq, pseudo-incompressible and compressible equations in a conservative flux form (<a href="https://doi.org/10.1007/s00162-009-0104-y">Klein, 2009</a>; <a href="https://doi.org/10.1175/mwr-d-12-00026.1">Rieper et al., 2013</a>), using a semi-implicit method that combines explicit and implicit time-stepping schemes (<a href="https://doi.org/10.1175/MWR-D-19-0073.1">Benacchio &amp; Klein, 2019</a>; <a href="https://doi.org/10.1175/MWR-D-21-0126.1">Schmid et al., 2021</a>; <a href="https://doi.org/10.1175/MWR-D-21-0175.1">Chew et al., 2022</a>). Spatially, the equations are discretized with a finite-volume method, such that all quantities are represented by averages over grid cells and fluxes are computed on the respective cell interfaces. The grid is staggered (<a href="https://doi.org/10.1016/b978-0-12-460817-7.50009-4">Arakawa &amp; Lamb, 1977</a>) so that the velocity components are defined at the same points as the corresponding fluxes of scalar quantities. PinCFlow.jl operates in a vertically stretched terrain-following coordinate system based on <a href="https://doi.org/10.1016/0021-9991(75)90037-6">Gal-Chen and Somerville (1975a)</a>, <a href="https://doi.org/10.1016/0021-9991(75)90054-6">Gal-Chen and Somerville (1975b)</a> and <a href="https://doi.org/10.1016/0021-9991(77)90057-2">Clark (1977)</a>.</p><p>The Lagrangian gravity-wave parameterization MS-GWaM (<em>M</em>ulti-<em>S</em>cale <em>G</em>ravity-<em>Wa</em>ve <em>M</em>odel) is interactively coupled to the dynamical core of PinCFlow.jl, so that unresolved gravity waves may be parameterized in a manner that accounts for transient wave-mean-flow interaction and horizontal wave propagation. The resolved fields are updated with tendencies computed by MS-GWaM at the beginning of every time step. A description of the theory behind MS-GWaM can be found in <a href="https://doi.org/10.1002/qj.2926">Achatz et al. (2017)</a> and <a href="https://doi.org/10.1063/5.0165180">Achatz et al. (2023)</a>. For a numerical perspective and more information on the development, see <a href="https://doi.org/10.1002/qj.2381">Muraschko et al. (2014)</a>, <a href="https://doi.org/10.1175/JAS-D-16-0069.1">Boeloeni et al. (2016)</a>, <a href="https://doi.org/10.1175/JAS-D-17-0289.1">Wilhelm et al. (2018)</a>, <a href="https://doi.org/10.1175/JAS-D-18-0337.1">Wei et al. (2019)</a> and <a href="https://doi.org/10.1175/JAS-D-24-0158.1">Jochum et al. (2025)</a>.</p><h2 id="User-guide"><a class="docs-heading-anchor" href="#User-guide">User guide</a><a id="User-guide-1"></a><a class="docs-heading-anchor-permalink" href="#User-guide" title="Permalink"></a></h2><h3 id="Installation"><a class="docs-heading-anchor" href="#Installation">Installation</a><a id="Installation-1"></a><a class="docs-heading-anchor-permalink" href="#Installation" title="Permalink"></a></h3><p>To install PinCFlow.jl, first make sure you have installed <a href="https://docs.julialang.org/en/v1/manual/installation/">Julia</a>. You can then run</p><pre><code class="language-shell hljs">julia --project -e &#39;using Pkg; Pkg.add(&quot;PinCFlow&quot;)&#39;</code></pre><p>to add PinCFlow.jl to your current project environment.</p><h3 id="Running-the-model"><a class="docs-heading-anchor" href="#Running-the-model">Running the model</a><a id="Running-the-model-1"></a><a class="docs-heading-anchor-permalink" href="#Running-the-model" title="Permalink"></a></h3><p>As a minimal example, the script</p><pre><code class="language-julia hljs">using PinCFlow

integrate(Namelists())</code></pre><p>runs PinCFlow.jl in its default configuration, if executed with</p><pre><code class="language-shell hljs">julia --project script.jl</code></pre><p>in your project&#39;s directory. This simulation will finish comparatively quickly and won&#39;t produce particularly interesting results, since PinCFlow.jl simply initializes a <span>$1 \times 1 \times 1 \ \mathrm{km^3}$</span> isothermal atmosphere at rest with a single grid cell and integrates the pseudo-incompressible equations over one hour. A more complex configuration can be set up by providing namelists with changed parameters. This is illustrated in PinCFlow.jl&#39;s example scripts. To run them, we recommend setting up an examples project by executing</p><pre><code class="language-shell hljs">julia --project=examples -e &#39;using Pkg; Pkg.add([&quot;CairoMakie&quot;, &quot;HDF5&quot;, &quot;HDF5_jll&quot;, &quot;MPI&quot;, &quot;MPICH_jll&quot;, &quot;MPIPreferences&quot;, &quot;PinCFlow&quot;, &quot;Revise&quot;])&#39;</code></pre><p>Having done this, you can easily run any of the example scripts without needing to worry about extra packages that you may need. For instance, executing the script</p><pre><code class="language-julia hljs"># examples/scripts/periodic_hill.jl

using Pkg

Pkg.activate(&quot;examples&quot;)

using MPI
using HDF5
using CairoMakie
using Revise
using PinCFlow

npx = length(ARGS) &gt;= 1 ? parse(Int, ARGS[1]) : 1
npz = length(ARGS) &gt;= 2 ? parse(Int, ARGS[2]) : 1

h0 = 500.0
l0 = 10000.0

lz = 20000.0
zr = 10000.0

atmosphere = AtmosphereNamelist(;
    model = Boussinesq(),
    background = StableStratification(),
    coriolis_frequency = 0.0,
    initial_u = (x, y, z) -&gt; 10.0,
)
domain = DomainNamelist(; x_size = 40, z_size = 40, lx = 20000.0, lz, npx, npz)
grid = GridNamelist(;
    resolved_topography = (x, y) -&gt; h0 / 2 * (1 + cos(pi / l0 * x)),
)
output =
    OutputNamelist(; output_variables = (:w,), output_file = &quot;periodic_hill.h5&quot;)
sponge = SpongeNamelist(;
    rhs_sponge = (x, y, z, t, dt) -&gt;
        z &gt;= zr ? sin(pi / 2 * (z - zr) / (lz - zr))^2 / dt : 0.0,
)

integrate(Namelists(; atmosphere, domain, grid, output, sponge))

if MPI.Comm_rank(MPI.COMM_WORLD) == 0
    h5open(&quot;periodic_hill.h5&quot;) do data
        plot_output(
            &quot;examples/results/periodic_hill.svg&quot;,
            data,
            (&quot;w&quot;, 1, 1, 1, 2);
        )
        return
    end
end
</code></pre><p>runs a 2D simulation with an initial wind of <span>$10 \ \mathrm{m \ s^{- 1}}$</span> that generates a mountain wave above a periodic hill and visualizes the results.</p><p>PinCFlow.jl uses parallel HDF5 to write simulation data. By default, the path to the output file is <code>pincflow_output.h5</code>. This may be changed by setting the parameter <code>output_file</code> of the namelist <code>output</code> accordingly (as illustrated above). The dimensions of most output fields are (in order) <span>$\widehat{x}$</span> (zonal axis), <span>$\widehat{y}$</span> (meridional axis), <span>$\widehat{z}$</span> (axis orthogonal to the vertical coordinate surfaces) and <span>$t$</span> (time). Ray-volume-property fields differ slightly in that they have an additional (spectral) dimension in front and a vertical dimension that includes the first ghost layer below the surface. To specify which fields are to be written, set the parameters <code>output_variables</code>, <code>save_ray_volumes</code> and <code>prepare_restart</code> of the namelist <code>output</code> accordingly (more details are given in the &quot;Reference&quot; section of the documentation).</p><p>For the visualization of simulation results, we recommend using <a href="https://docs.makie.org/stable/">Makie.jl</a> with the <code>CairoMakie</code> backend. PinCFlow.jl has an extension which exports a few convenience functions if <code>CairoMakie</code> is loaded. This is utilized in the above script, yielding a plot of the vertical wind at the end of the simulation (see below). You can find more examples on the &quot;Examples&quot; page of the documentation. A description of all namelists and their parameters is provided in the &quot;Reference&quot; section.</p><p><img src="examples/results/periodic_hill.svg" alt/></p><p>If you want to run PinCFlow.jl in parallel, make sure you are using the correct backends for <a href="https://juliaparallel.org/MPI.jl/latest/">MPI.jl</a> and <a href="https://juliaio.github.io/HDF5.jl/stable/">HDF5.jl</a>. By default, the two packages use JLL backends that have been automatically installed. If you want to keep this setting, you only need to make sure to use the correct MPI binary (specifically not that of a default MPI installation on your system). For example, with</p><pre><code class="language-shell hljs">mpiexec=$(julia --project=examples -e &#39;using MPICH_jll; println(MPICH_jll.mpiexec_path)&#39;)
${mpiexec} -n 16 julia examples/scripts/periodic_hill.jl 4 4</code></pre><p>you can run the above simulation in 16 MPI processes. Note that by passing extra arguments to the script, you set the parameters <code>npx</code> and <code>npz</code> of the namelist <code>domain</code>, which represent the number of MPI processes in <span>$\widehat{x}$</span> and <span>$\widehat{z}$</span>. Their product must be equal to the total number of processes, otherwise PinCFlow.jl will throw an error.</p><p>However, if you plan to run PinCFlow.jl on a cluster, you may want to consider using a provided MPI installation as backend. In that case, the MPI preferences need to be updated accordingly and the HDF5 backend has to be set to a library that has been installed with parallel support, using the chosen MPI installation. This can be done by running</p><pre><code class="language-shell hljs">julia --project=examples -e &#39;using MPIPreferences; MPIPreferences.use_system_binary(; library_names = [&quot;/path/to/mpi/library/&quot;])&#39;
julia --project=examples -e &#39;using HDF5; HDF5.API.set_libraries!(&quot;/path/to/libhdf5.so&quot;, &quot;/path/to/libhdf5_hl.so&quot;)&#39;</code></pre><p>with the paths set appropriately (more details can be found in the documentations of MPI.jl and HDF5.jl). Note that this configuration will be saved in <code>examples/LocalPreferences.toml</code>, so that the new backends will be used by all future scripts run in the examples project. By running</p><pre><code class="language-shell hljs">julia --project=examples -e &#39;using MPIPreferences; MPIPreferences.use_jll_binary()&#39;
julia --project=examples -e &#39;using HDF5; HDF5.API.set_libraries!()&#39;</code></pre><p>you can restore the default backends. Having configured MPI.jl and HDF5.jl to use installations on your system, you can run</p><pre><code class="language-shell hljs">mpiexec -n 16 julia examples/scripts/periodic_hill.jl 4 4</code></pre><p>with <code>mpiexec</code> being your chosen system binary. For users who would like to run PinCFlow.jl on <a href="https://csc.uni-frankfurt.de/wiki/doku.php?id=public:usage:goethe">Goethe</a> or <a href="https://docs.dkrz.de/doc/levante/index.html">Levante</a>, shell-script examples are provided in the folder <code>examples/scripts</code> of the repository.</p><h2 id="List-of-publications"><a class="docs-heading-anchor" href="#List-of-publications">List of publications</a><a id="List-of-publications-1"></a><a class="docs-heading-anchor-permalink" href="#List-of-publications" title="Permalink"></a></h2><ol><li><p>Initial flow solver: <a href="https://doi.org/10.1175/mwr-d-12-00026.1">Rieper et al. (2013)</a></p></li><li><p>Initial gravity-wave scheme: <a href="https://doi.org/10.1002/qj.2381">Muraschko et al. (2014)</a></p></li><li><p>Gravity-wave breaking scheme: <a href="https://doi.org/10.1175/JAS-D-16-0069.1">Boeloeni et al. (2016)</a></p></li><li><p>Gravity-wave theory: <a href="https://doi.org/10.1002/qj.2926">Achatz et al. (2017)</a></p></li><li><p>Coupling of the flow solver and gravity-wave scheme: <a href="https://doi.org/10.1175/JAS-D-17-0289.1">Wilhelm et al. (2018)</a></p></li><li><p>Horizontal propagation and direct approach in the gravity-wave scheme: <a href="https://doi.org/10.1175/JAS-D-18-0337.1">Wei et al. (2019)</a></p></li><li><p>Semi-implicit time scheme: <a href="https://doi.org/10.1175/MWR-D-21-0126.1">Schmid et al. (2021)</a></p></li><li><p>Extended gravity-wave theory: <a href="https://doi.org/10.1063/5.0165180">Achatz et al. (2023)</a></p></li><li><p>Terrain-following coordinates &amp; orographic source: <a href="https://doi.org/10.1175/JAS-D-24-0158.1">Jochum et al. (2025)</a></p></li></ol></article><nav class="docs-footer"><a class="docs-footer-nextpage" href="examples/">Examples »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.16.0 on <span class="colophon-date" title="Wednesday 19 November 2025 08:43">Wednesday 19 November 2025</span>. Using Julia version 1.10.10.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
