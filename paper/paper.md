---
title: 'PinCFlow.jl: An idealized-atmospheric-flow solver coupled to the 3D transient gravity-wave model MS-GWaM'
tags:
  - Julia
  - Gravity waves
  - Mountain waves
  - Parameterization
  - High-resolution simulations
authors:
  - name: Felix Jochum
    corresponding: true
    orcid: 0009-0006-9267-5006
    affiliation: 1
  - name: Irmgard Knop
    affiliation: 1
  - name: Sandra Klewinghaus
    orcid: 0009-0009-0858-9845
    affiliation: 1
  - name: Jonas Rothermel
    affiliation: 1
  - name: Marco Artiano
    orcid: 0009-0009-5872-702X
    affiliation: 2
  - name: Arpit Babbar
    orcid: 0000-0002-9453-370X
    affiliation: 2
  - name: Hendrik Ranocha
    orcid: 0000-0002-3456-2277
    affiliation: 2
  - name: Stamen Dolaptchiev
    affiliation: 1
  - name: Ulrich Achatz
    affiliation: 1
affiliations:
  - name: Theory of Atmospheric Dynamics and Climate, Goethe University Frankfurt, Germany
    index: 1
  - name: Numerical Mathematics, Johannes Gutenberg University Mainz, Germany
    index: 2
date: 23 October 2025
bibliography: paper.bib
---

# Summary

PinCFlow.jl is an atmospheric-flow solver that was designed for conducting idealized simulations. It integrates the Boussinesq, pseudo-incompressible and compressible equations in a conservative flux form [@Klein2009; @Rieper2013], using a semi-implicit method that combines explicit and implicit time-stepping schemes [@Benacchio2019; @Schmid2021; @Chew2022]. Spatially, the equations are discretized with a finite-volume method, such that all quantities are represented by spatial averages over grid cells and fluxes are computed on the respective cell interfaces. The grid is staggered so that the velocity components are defined at the same points as the corresponding fluxes of scalar quantities. PinCFlow.jl operates in a vertically stretched terrain-following coordinate system based on @GalChen1975a, @GalChen1975b and @Clark1977.

The Lagrangian WKB model MS-GWaM is interactively coupled to the dynamical core of PinCFlow.jl, so that unresolved gravity waves may be parameterized in a manner that accounts for transient wave-mean-flow interaction and horizontal wave propagation. The resolved fields are updated with tendencies computed by MS-GWaM at the beginning of every time step. A description of the theory behind MS-GWaM can be found in @Achatz2017 and @Achatz2023. For a numerical perspective and more information on the development, see @Muraschko2015, @Boeloeni2016, @Wilhelm2018, @Wei2019 and @Jochum2025.

# Statement of need

Atmospheric gravity waves are generated by various sources, including convection, flow over mountains and jet-frontal imbalances. As they propagate upward, they transport and deposit momentum and energy, thus impacting the large-scale flow. A significant part of the gravity-wave spectrum cannot be resolved by weather and climate models at their respective standard resolutions and must therefore be parameterized [@Fritts2003; @Alexander2010; @Achatz2024].

Most gravity-wave parameterizations rely on single-column and steady-state approximations, since these yield a comparatively simple and efficient method of calculating the mean-flow impact. However, it has become increasingly apparent that transient wave-mean-flow interaction and horizontal gravity-wave propagation need to be accounted for in an accurate description of gravity-wave-mean-flow interaction [@Sato2009; @Senf2011; @Ehard2017; @Muraschko2015; @Boeloeni2016; @Wei2019]. The Multi-Scale Gravity-Wave Model (MS-GWaM) has been created for this reason. Essential to its development, as to the improvement of the fundamental understanding of atmospheric dynamics, is the study of gravity waves in idealized high-resolution simulations. PinCFlow.jl provides a modeling infrastructure tailored to this exact need. Moreover, it is interactively coupled to MS-GWaM, thus allowing for direct comparison between wave-resolving and wave-parameterizing simulations.

# Features

\autoref{features} shows an overview of PinCFlow.jl's features. As has been mentioned above, the model can be used to integrate the Boussinesq, pseudo-incompressible or compressible equations. For each of these, it provides a number of backgrounds defined by namelist parameters. The initial deviations of the prognostic variables from the background are set with user-defined functions. In addition to the momentum, continuity and potential-temperature equations, the flow solver integrates the prognostic equation for an arbitrary passive tracer.

PinCFlow.jl's grid is determined from a user-defined surface topography, using a height-based terrain-following coordinate system. Fluxes are computed with a finite-volume (MUSCL) scheme [e.g. @Leer2003], using the monotonized-centered variant limiter [e.g. @Kemm2011]. In addition to the advection terms, the model includes molecular friction, heat conduction and an artificial momentum-diffusion term.

MS-GWaM can be run in a 1D steady-state mode (which represents classic gravity-wave parameterizations), a 1D transient mode (so that the impact of transient wave-mean-flow interaction may be investigated separately, i.e. without horizontal propagation) and a 3D transient mode (the full implementation of the theory). It is interactively coupled to the resolved dynamics, so that the evolution of the gravity-wave field depends on the current state of the large-scale flow and in turn changes it via tendencies that are added to the prognostic equations. This coupling includes the impact of gravity-wave fluxes on the large-scale tracer. The parameterization has an inbuilt orographic source which launches mountain waves generated by the resolved flow crossing unresolved terrain. The latter is represented by an arbitrary spectrum computed by a user-defined function. Moreover, MS-GWaM may be initialized with any wave field, also via a user-defined function.

By default, the flow solver uses an adaptive time step determined from several stability criteria, including CFL conditions with respect to the resolved flow and the maximum group velocities of the unresolved gravity-wave field computed by MS-GWaM. The CFL numbers are configurable, however, one may also run the model with a fixed time step.

MPI parallelization is supported in all grid dimensions. The number of MPI tasks is set per dimension, using the parameters of the domain namelist. Furthermore, one may pass a base communicator to the model, facilitating the setup of ensemble simulations in a single Julia script.

![Overview of PinCFlow.jl's features.\label{features}](features.pdf)

# Related research and software

PinCFlow.jl originated from a Fortran code [@Rieper2013] that was used and extended for gravity-wave research [@Boeloeni2016; @Wilhelm2018; @Wei2019; @Schmid2021; @Jochum2025]. Its semi-implicit time scheme [@Schmid2021] is based on those implemented in the models introduced by @Benacchio2019 and @Chew2022. In contrast to these models, PinCFlow.jl does not provide seamless access to soundproof and hydrostatic dynamics (instead, the prognostic equations are set in the initialization and not changed during the simulation) or any data assimilation capabilities. What distinguishes it from other software is its implementation of MS-GWaM. The latter was originally developed as an isolated code [@Muraschko2015; @Boeloeni2016] and later integrated into the forerunner of PinCFlow.jl [by @Jochum2025; @Wilhelm2018; @Wei2019] and the NWP-and-climate model ICON [by @Boeloeni2021; @Kim2021; @Kim2024; @Voelker2024]. PinCFlow.jl's version of MS-GWaM differs from the ICON version in several components, most notably its coordinate system, discretization and sources, however, the underlying theory [@Achatz2017; @Achatz2023] is the same. The code presented here provides the first open access to a full implementation of MS-GWaM coupled to a flow solver within an idealized and highly configurable framework.

# Acknowledgements

F. J. and U. A. are grateful for the support of Eric and Wendy Schmidt through the Schmidt Sciences VESRI "DataWave" project. M. A., A. B., and H. R. were supported by the German Research Foundation (Deutsche Forschungsgemeinschaft DFG, project number 528753982). S. D., I. K. and U. A. thank the German Research Foundation (DFG) for partial support through CRC 301 "TPChange" (Project No. 428312742 and Projects B06 "Impact of small-scale dynamics on UTLS transport and mixing", B07 "Impact of cirrus clouds on tropopause structure" and Z03 "Joint model development and modelling synthesis"), and U. A. thanks DFG for support through the CRC 181 "Energy transfers in Atmosphere and Ocean" (Project No. 274762653 and Projects W01 "Gravity-wave parameterization for the atmosphere" and S02 "Improved Parameterizations and Numerics in Climate Models"). M. A., A. B. and H. R. were supported by the German Research Foundation (Deutsche Forschungsgemeinschaft DFG, project number 528753982). S. K. thanks Ray Chew for his help with the implementation of the compressible mode.


# References
